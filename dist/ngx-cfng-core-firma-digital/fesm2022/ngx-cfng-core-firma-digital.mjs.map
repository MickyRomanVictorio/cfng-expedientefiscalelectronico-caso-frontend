{"version":3,"file":"ngx-cfng-core-firma-digital.mjs","sources":["../../../projects/ngx-cfng-core-firma-digital/src/lib/services/firma-digital-cliente.service.ts","../../../projects/ngx-cfng-core-firma-digital/src/lib/enviroments/environment.ts","../../../projects/ngx-cfng-core-firma-digital/src/lib/utils/param-firma.ts","../../../projects/ngx-cfng-core-firma-digital/src/lib/ngx-cfng-core-firma-digital.service.ts","../../../projects/ngx-cfng-core-firma-digital/src/lib/ngx-cfng-core-firma-digital.component.ts","../../../projects/ngx-cfng-core-firma-digital/src/lib/components/firma-digital-cliente.component.ts","../../../projects/ngx-cfng-core-firma-digital/src/public-api.ts","../../../projects/ngx-cfng-core-firma-digital/src/ngx-cfng-core-firma-digital.ts"],"sourcesContent":["import { EventEmitter, Injectable, Output } from '@angular/core';\r\nimport { FirmaInterface } from '../models/firma-digital.interface';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FirmaDigitalClienteService {\r\n\r\n  @Output() processSignClient: EventEmitter<string> = new EventEmitter<string>();\r\n  @Output() sendDataSign: EventEmitter<FirmaInterface> = new EventEmitter<FirmaInterface>();\r\n\r\n  constructor() { }\r\n}\r\n","export const enviroment = {\r\n  production: true,\r\n  cdn:{\r\n    jquey: 'https://code.jquery.com/jquery-3.6.0.min.js',\r\n    firma_peru: 'https://apps.firmaperu.gob.pe/web/clienteweb/firmaperu.min.js',\r\n    integrador: 'http://172.16.111.112:8085/assets/js/integrador.firma.js'\r\n  },\r\n  portClientSign: '48596'\r\n}\r\n","import { enviroment } from \"../enviroments/environment\";\r\nimport { FirmaParamInterface } from \"../models/firma-digital.interface\";\r\n\r\n\r\nexport function sendParamOne(data: FirmaParamInterface): void {\r\n    const base64: string = btoa(JSON.stringify(data));\r\n    const port: string = `${enviroment.portClientSign}`\r\n    startSignature(port, base64);\r\n}\r\n\r\ndeclare function startSignature(port: string, base64: string): void;\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgxCfngCoreFirmaDigitalService {\r\n\r\n  private scripts: any = {};\r\n\r\n  load(scriptName: string, src: string): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      if (this.scripts[scriptName]) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement('script');\r\n      script.src = src;\r\n      script.async = true;\r\n      script.onload = () => {\r\n        this.scripts[scriptName] = true;\r\n        resolve();\r\n      };\r\n      script.onerror = (error: any) => reject(error);\r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n\r\n  loadScriptsSequentially(scripts: { name: string, src: string }[]): Promise<void> {\r\n    return scripts.reduce(async (promiseChain, script) => {\r\n      return promiseChain.then(() => this.load(script.name, script.src));\r\n    }, Promise.resolve());\r\n  }\r\n\r\n}\r\n","import { AfterViewInit, Component } from '@angular/core';\r\nimport { NgxCfngCoreFirmaDigitalService } from './ngx-cfng-core-firma-digital.service';\r\nimport { enviroment } from './enviroments/environment';\r\n\r\n\r\n@Component({\r\n  selector: 'cfe-core-firma-digital',\r\n  standalone: true,\r\n  imports: [],\r\n  template: ``,\r\n  styles: ``,\r\n})\r\nexport class NgxCfngCoreFirmaDigitalComponent implements AfterViewInit {\r\n\r\n  constructor(private ngxCoreFirmaDigitalService: NgxCfngCoreFirmaDigitalService\r\n  ) {}\r\n\r\n  ngAfterViewInit(): void {\r\n    this.ngxCoreFirmaDigitalService\r\n      .loadScriptsSequentially([\r\n        { name: 'jquery', src: enviroment.cdn.jquey },\r\n        { name: 'integrador', src: enviroment.cdn.integrador },\r\n        { name: 'firmaperu', src: enviroment.cdn.firma_peru },\r\n      ])\r\n      .then(() => {\r\n        console.log('CFE Core Firma Digital iniciado');\r\n      })\r\n      .catch((error: any) => {\r\n        console.error('Error CFE Integrador Firma Digital: ', error.error);\r\n      });\r\n  }\r\n\r\n}\r\n","import { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { FirmaDigitalClienteService } from '../services/firma-digital-cliente.service';\r\nimport { fromEvent, Subscription } from 'rxjs';\r\nimport { FirmaInterface, FirmaParamInterface } from '../models/firma-digital.interface';\r\nimport { sendParamOne } from '../utils/param-firma';\r\nimport { NgxCfngCoreFirmaDigitalComponent } from '../ngx-cfng-core-firma-digital.component';\r\n\r\n@Component({\r\n  selector: 'cfe-lib-firma-digital-cliente',\r\n  standalone: true,\r\n  imports: [NgxCfngCoreFirmaDigitalComponent],\r\n  template: `\r\n    <div id=\"addComponent\"></div>\r\n    <cfe-core-firma-digital></cfe-core-firma-digital>\r\n    `,\r\n  styles: ``,\r\n})\r\nexport class FirmaDigitalClienteComponent implements OnInit, OnDestroy {\r\n\r\n  private suscriptions: Subscription[] = [];\r\n\r\n  constructor(private firmaDigitalClienteService: FirmaDigitalClienteService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.suscriptions.push(\r\n      this.firmaDigitalClienteService.sendDataSign.subscribe((data: FirmaInterface) => {\r\n        this.verificarDataFirma( data )\r\n      })\r\n    );\r\n\r\n    fromEvent(window, 'signOK').subscribe(() => {\r\n      this.firmaDigitalClienteService.processSignClient.emit('0');\r\n    });\r\n\r\n    fromEvent(window, 'signBAD').subscribe(() => {\r\n      this.firmaDigitalClienteService.processSignClient.emit('1');\r\n    });\r\n\r\n  }\r\n\r\n  private verificarDataFirma( dataFirma: FirmaInterface ): void {\r\n    if (\r\n      dataFirma.id === null ||\r\n      dataFirma.id === undefined ||\r\n      dataFirma.id === ''\r\n    ) {\r\n      alert( 'Es requerido un identificador de documento para continuar con el proceso');\r\n      return;\r\n    }\r\n\r\n    this.enviarDataFirma( dataFirma );\r\n  }\r\n\r\n  private enviarDataFirma( dataFirma: FirmaInterface ): void {\r\n\r\n    let param_pdf: FirmaParamInterface = {\r\n      param_url: dataFirma.param_url,\r\n      param_token: JSON.stringify(dataFirma),\r\n      document_extension: dataFirma.extension,\r\n    };\r\n\r\n    sendParamOne(param_pdf);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n      this.suscriptions.forEach((suscripcion) => suscripcion.unsubscribe());\r\n  }\r\n\r\n}\r\n","/*\r\n * Public API Surface of ngx-cfng-core-firma-digital\r\n */\r\n\r\nexport * from './lib/services/firma-digital-cliente.service';\r\nexport * from './lib/components/firma-digital-cliente.component';\r\nexport * from './lib/models/firma-digital.interface';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i1.NgxCfngCoreFirmaDigitalService","i1.FirmaDigitalClienteService"],"mappings":"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"}