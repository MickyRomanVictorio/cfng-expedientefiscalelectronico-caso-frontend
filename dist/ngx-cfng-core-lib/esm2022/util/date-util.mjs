import { CONSULTA_CASO_RANGO_FECHA } from '../constant/constants-constant';
import { format, getHours, getMinutes } from 'date-fns';
import { es } from 'date-fns/locale';
import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
export class DateUtil {
    constructor() {
        /**
        * Permite formatear una fecha en formato YYYY-MM-DD HH:mm:ss a una cadena en formato DD MM YYYY HH:mm a.m./p.m.
        * Ejemplo: 2023-05-15 14:30:00 a 15 May 2023 02:30 p.m.
        *
        * @param fechaHora
        * @returns string
        */
        this.formatearFechaHoraAbreviada = (fechaHora) => {
            if (fechaHora === null || fechaHora === undefined) {
                return '-';
            }
            const meses = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const fecha = new Date(fechaHora);
            if (isNaN(fecha.getTime())) {
                throw new Error(`Formato de fecha no válido: "${fechaHora}". Se esperaba un formato como 'YYYY-MM-DD' o 'YYYY-MM-DD HH:mm:ss'.`);
            }
            const dia = fecha.getDate().toString().padStart(2, '0');
            const mes = meses[fecha.getMonth()];
            const anio = fecha.getFullYear();
            const horas = fecha.getHours();
            const minutos = fecha.getMinutes().toString().padStart(2, '0');
            const periodo = horas >= 12 ? 'p.m.' : 'a.m.';
            const horasFormateadas = (horas % 12 || 12).toString().padStart(2, '0');
            if (fechaHora.length <= 10) {
                return `${dia} ${mes} ${anio}`;
            }
            return `${dia} ${mes} ${anio} ${horasFormateadas}:${minutos} ${periodo}`;
        };
    }
    // TODO: Ref cfng-core-lib - obtenerTiempoTranscurrido_DHS
    obtenerTiempoTranscurrido_DHS(fechaInicio) {
        const start = new Date(fechaInicio);
        const end = new Date();
        let difference = Math.abs(end.valueOf() - start.valueOf());
        let days = Math.floor(difference / (1000 * 60 * 60 * 24));
        let hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
        return days + 'd ' + hours + 'h ' + minutes + 'm';
    }
    // TODO: Ref cfng-core-lib - obtenerFormatoFecha_DDMMYYYY
    obtenerFormatoFecha_DDMMYYYY(date) {
        if (typeof date === 'string') {
            const partesFecha = date.split('/');
            const dia = parseInt(partesFecha[0], 10);
            const mes = parseInt(partesFecha[1], 10) - 1;
            const anio = parseInt(partesFecha[2], 10);
            date = new Date(dia, mes, anio);
        }
        if (!isNaN(date.getTime())) {
            const day = ("0" + date.getDate()).slice(-2);
            const month = ("0" + (date.getMonth() + 1)).slice(-2);
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        else {
            console.error('Formato de fecha inválida: :', date);
            return '-';
        }
    }
    // TODO: Ref cfng-core-lib - validarFormatoHora
    validarFormatoHora(event) {
        const code = (event.which) ? event.which : event.keyCode;
        if (code == 8) {
            return true;
        }
        else
            return code >= 48 && code <= 58;
    }
    // TODO: Ref cfng-core-lib - calcularDiasFecha
    calcularDiasFecha(date) {
        let dateArray = date.split("/");
        return (dateArray[0] * 1) + (dateArray[1] * 1) * 30 + (dateArray[2] * 1) * 360;
    }
    obtenerFormatoFechaFromDate_DDMMYYYY(fecha) {
        if (fecha !== undefined || fecha !== null) {
            let fe = new Date(fecha);
            const dia = fe.getDate();
            const mes = fe.getMonth() + 1;
            const anio = fe.getFullYear();
            const mesFormateado = mes < 10 ? `0${mes}` : mes.toString();
            const diaFormateado = dia < 10 ? `0${dia}` : dia.toString();
            const fechaFormateada = `${diaFormateado}/${mesFormateado}/${anio}`;
            return fechaFormateada;
        }
        else {
            return '-';
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: DateUtil, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: DateUtil, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.0", ngImport: i0, type: DateUtil, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: () => [] });
export const formatDateToAbbreviated = (input) => {
    if (input === '' || input === undefined)
        return '';
    const months = {
        '01': 'Ene.',
        '02': 'Feb.',
        '03': 'Mar.',
        '04': 'Abr.',
        '05': 'May.',
        '06': 'Jun.',
        '07': 'Jul.',
        '08': 'Ago.',
        '09': 'Sep.',
        '10': 'Oct.',
        '11': 'Nov.',
        '12': 'Dic.',
    };
    const [day, month, year] = input.split('/');
    const formattedMonth = months[month];
    return `${parseInt(day)} ${formattedMonth} ${year}`;
};
export const convertTo12HourFormat = (input) => {
    if (input === '' || input === undefined)
        return '';
    const [hour, minutes] = input.split(':');
    const hourNum = parseInt(hour);
    const ampm = hourNum >= 12 ? 'p.m.' : 'a.m.';
    const hour12 = hourNum > 12 ? hourNum - 12 : hourNum === 0 ? 12 : hourNum;
    return `${hour12}:${minutes} ${ampm}`;
};
export const convertTo24HourFormat = (input) => {
    const [hours, minutes] = input.split(':').map(Number);
    const ampm = hours >= 12 ? 'p.m.' : 'a.m.';
    if (hours === 0 && minutes < 60) {
        return `${hours.toString().padStart(2, '0')}:${minutes
            .toString()
            .padStart(2, '0')} ${ampm}`;
    }
    let hours12 = hours % 12;
    hours12 = hours12 ? hours12 : 12;
    return `${hours12.toString().padStart(2, '0')}:${minutes
        .toString()
        .padStart(2, '0')} ${ampm}`;
};
export const obtenerFechaLetras = (fecha) => {
    const nombreDiaSemana = format(fecha, 'EEEE', { locale: es });
    const dia = format(fecha, 'd', { locale: es });
    const mes = format(fecha, 'MMMM', { locale: es });
    const anho = format(fecha, 'y', { locale: es });
    return `${nombreDiaSemana} ${dia} DE ${mes.toUpperCase()} DE ${anho}`?.toUpperCase();
};
export const obtenerHoraAMPM = (fecha) => {
    const hora = getHours(fecha);
    const minutos = getMinutes(fecha);
    const ampm = hora >= 12 ? 'P.M.' : 'A.M.';
    const hora12 = hora > 12 ? hora - 12 : hora === 0 ? 12 : hora;
    return `${hora12.toString().padStart(2, '0')}:${minutos
        .toString()
        .padStart(2, '0')} ${ampm}`;
};
export const getYYMMDDDashedToDDMMYYSlash = (dateStr) => {
    if (!dateStr)
        return null;
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}/${year}`;
};
export const obtenerFechaDDMMYYYY = (fecha) => {
    const dia = fecha.getDate().toString().padStart(2, '0');
    const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
    const anho = fecha.getFullYear();
    return `${dia}/${mes}/${anho}`;
};
export const obtenerFechaTipoDate = (fecha) => {
    const partes = fecha.split('/');
    const dia = parseInt(partes[0], 10);
    const mes = parseInt(partes[1], 10) - 1;
    const anho = parseInt(partes[2], 10);
    return new Date(anho, mes, dia);
};
export const obtenerHoraHH24MI = (fecha) => {
    const horas = fecha.getHours().toString().padStart(2, '0');
    const minutos = fecha.getMinutes().toString().padStart(2, '0');
    return `${horas}:${minutos}`;
};
export const obtenerHoraTipoDate = (hora) => {
    const [horas, minutos] = hora
        .split(':')
        .map((partes) => parseInt(partes, 10));
    const today = new Date();
    return new Date(today.getFullYear(), today.getMonth(), today.getDate(), horas, minutos);
};
const getLeadingZero = (number) => {
    return `${number < 10 ? '0' : ''}${number}`;
};
export const getDDMMYYSlashToDDMMYYDashed = (date = null) => {
    const today = date ? new Date(date) : new Date();
    const day = today.getDate();
    const month = today.getMonth() + 1;
    const year = today.getFullYear();
    return `${getLeadingZero(day)}-${getLeadingZero(month)}-${year}`;
};
export const calcularTiempoRestante = (fechaFinDetencion) => {
    const fechaFinTimestamp = new Date(fechaFinDetencion?.replace(/(\d{2})\/(\d{2})\/(\d{4})/, '$3-$2-$1')).getTime();
    const ahora = new Date().getTime();
    const tiempoRestanteMillis = fechaFinTimestamp - ahora;
    if (tiempoRestanteMillis <= 0) {
        return 'Completado';
    }
    const dias = Math.floor(tiempoRestanteMillis / (1000 * 60 * 60 * 24));
    const horas = Math.floor((tiempoRestanteMillis % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutos = Math.floor((tiempoRestanteMillis % (1000 * 60 * 60)) / (1000 * 60));
    const segundos = Math.floor((tiempoRestanteMillis % (1000 * 60)) / 1000);
    let tiempoRestante = '';
    if (dias > 0) {
        tiempoRestante += `${dias}d`;
    }
    if (horas > 0 && tiempoRestante?.split(' ').length < 2) {
        tiempoRestante += ` ${horas}h`;
    }
    if (minutos > 0 && tiempoRestante?.trim()?.split(' ').length < 2) {
        tiempoRestante += ` ${minutos}m`;
    }
    if (segundos > 0 && tiempoRestante?.trim()?.split(' ').length < 2) {
        tiempoRestante += ` ${segundos}s`;
    }
    return `${tiempoRestante?.trim() || '0s'} faltantes`;
};
export const string2DateReniec = (fechaReniec) => {
    const [dia, mes, anio] = fechaReniec.split('/');
    return new Date(+anio, +mes - 1, +dia);
};
export const obtenerFechaHoraDDMMYYYYHHMMA = (fecha) => {
    const dia = fecha.getDate().toString().padStart(2, '0');
    const mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
    const anho = fecha.getFullYear();
    const horas = (fecha.getHours() % 12 || 12).toString().padStart(2, '0');
    const minutos = fecha.getMinutes().toString().padStart(2, '0');
    const ampm = fecha.getHours() >= 12 ? 'PM' : 'AM';
    return `${dia}/${mes}/${anho} ${horas}:${minutos} ${ampm}`;
};
export function dateTimeValidator(control) {
    const dateControl = control.get('fechaLlamada');
    const timeControl = control.get('horaLlamada');
    if (dateControl && timeControl && dateControl.value && timeControl.value) {
        const date = new Date(dateControl.value);
        const time = new Date(timeControl.value);
        date.setHours(time.getHours());
        date.setMinutes(time.getMinutes());
        // Current datetime for comparison
        const currentDateTime = new Date();
        if (date > currentDateTime) {
            // If the combined datetime is in the future, return an error
            return { invalidDateTime: true };
        }
    }
    return null; // If validation passes
    const inputDate = new Date(control.value);
    const currentDate = new Date();
    console.log(inputDate, currentDate, inputDate > currentDate);
    if (inputDate > currentDate) {
        return { futureDate: true };
    }
    return null;
}
export const obtenerTiempoTranscurrido = (fechaInicial) => {
    let timeAgo = '';
    const currentDate = new Date();
    const timeDifference = currentDate.getTime() - fechaInicial.getTime();
    const seconds = Math.floor(timeDifference / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    if (days > 0) {
        timeAgo = `hace ${days} día(s)`;
    }
    else if (hours > 0) {
        timeAgo = `hace ${hours} hora(s)`;
    }
    else if (minutes > 0) {
        timeAgo = `hace ${minutes} minuto(s)`;
    }
    else {
        timeAgo = `hace ${seconds} segundo(s)`;
    }
    return timeAgo;
};
/**
 * Valida el rango de fechas máximo 1 mes. Usado para los formularios reactivos
 *
 * @param group
 * @returns null | object
 */
export const validarRangoFechaForm = (group) => {
    const fechaDesde = group.get('fechaDesde')?.value;
    const fechaHasta = group.get('fechaHasta')?.value;
    if (!fechaDesde || !fechaHasta) {
        return null; // No validar si una de las fechas no está definida
    }
    const inicio = new Date(fechaDesde);
    const fin = new Date(fechaHasta);
    const hoy = new Date();
    if (!(fin <= hoy)) {
        return { rangoFechaInvalidoMax: true };
    }
    // Calcular la diferencia en meses y días
    const diferenciaMeses = fin.getMonth() -
        inicio.getMonth() +
        (fin.getFullYear() - inicio.getFullYear()) * 12;
    const diferenciaDias = fin.getDate() - inicio.getDate();
    // Verificar si la diferencia es exactamente un mes o menos
    const rangoValido = (diferenciaMeses === 1 && diferenciaDias <= 0) ||
        (diferenciaMeses === 0 && diferenciaDias >= 0);
    return rangoValido ? null : { rangoFechaInvalido: true };
};
/**
 * Valida el rango de fechas máximo 6 meses. Usado para los formularios reactivos
 *
 * @param group
 * @returns null | object
 */
export const validarRangoUltimo6MesesForm = (group) => {
    const fechaDesde = group.get('fechaDesde')?.value;
    const fechaHasta = group.get('fechaHasta')?.value;
    if (!fechaDesde || !fechaHasta) {
        return null; // No validar si una de las fechas no está definida
    }
    const inicio = new Date(fechaDesde);
    const fin = new Date(fechaHasta);
    const hoy = new Date();
    if (!(fin <= hoy)) {
        return { rangoFechaInvalidoMax: true };
    }
    // Calcular la diferencia en meses y días
    let diferenciaMeses = fin.getMonth() -
        inicio.getMonth() +
        (fin.getFullYear() - inicio.getFullYear()) * 12;
    let diferenciaDias = fin.getDate() - inicio.getDate();
    // Ajustar la diferencia de días si es negativa
    if (diferenciaDias < 0) {
        diferenciaMeses -= 1;
        diferenciaDias += 30;
    }
    // Verificar si la diferencia es de 6 meses o menos y los días no exceden el rango
    const rangoValido = diferenciaMeses < 6 || (diferenciaMeses === 6 && diferenciaDias <= 0);
    return rangoValido ? null : { rangoFechaInvalido: true };
};
export function rangoFechaXDefecto() {
    const meses = CONSULTA_CASO_RANGO_FECHA; /*Se resta 6 meses a la fecha actual */
    const fechaFin = new Date();
    const fechaInicio = new Date(fechaFin);
    const mesInicio = fechaInicio.getMonth();
    fechaInicio.setMonth(fechaFin.getMonth() - meses);
    // Ajuste para casos en los que restar meses cambie el año y cause un problema de desbordamiento
    if (fechaInicio.getMonth() !== (((mesInicio - meses) % 12) + 12) % 12) {
        fechaInicio.setDate(0); // Establece al último día del mes anterior
    }
    return {
        inicio: fechaInicio,
        fin: fechaFin,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS11dGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWNmbmctY29yZS1saWIvdXRpbC9kYXRlLXV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFDLHlCQUF5QixFQUFDLE1BQU0sZ0NBQWdDLENBQUM7QUFDekUsT0FBTyxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBQ3RELE9BQU8sRUFBQyxFQUFFLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUNuQyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDOztBQUt6QyxNQUFNLE9BQU8sUUFBUTtJQUVuQjtRQWtFQTs7Ozs7O1VBTUU7UUFDSyxnQ0FBMkIsR0FBRyxDQUFDLFNBQWlCLEVBQVUsRUFBRTtZQUVqRSxJQUFJLFNBQVMsS0FBSyxJQUFJLElBQUksU0FBUyxLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUNsRCxPQUFPLEdBQUcsQ0FBQztZQUNiLENBQUM7WUFFRCxNQUFNLEtBQUssR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFFbEcsTUFBTSxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7WUFFakMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQztnQkFDekIsTUFBTSxJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsU0FBUyxzRUFBc0UsQ0FBQyxDQUFBO1lBQ3BJLENBQUM7WUFFRCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLENB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UUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO1FBQ3RFLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQywyQ0FBMkM7SUFDckUsQ0FBQztJQUNELE9BQU87UUFDTCxNQUFNLEVBQUUsV0FBVztRQUNuQixHQUFHLEVBQUUsUUFBUTtLQUNkLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtGb3JtR3JvdXAsIFZhbGlkYXRpb25FcnJvcnN9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7Q09OU1VMVEFfQ0FTT19SQU5HT19GRUNIQX0gZnJvbSAnLi4vY29uc3RhbnQvY29uc3RhbnRzLWNvbnN0YW50JztcbmltcG9ydCB7Zm9ybWF0LCBnZXRIb3VycywgZ2V0TWludXRlc30gZnJvbSAnZGF0ZS1mbnMnO1xuaW1wb3J0IHtlc30gZnJvbSAnZGF0ZS1mbnMvbG9jYWxlJztcbmltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIERhdGVVdGlsIHtcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgLy8gVE9ETzogUmVmIGNmbmctY29yZS1saWIgLSBvYnRlbmVyVGllbXBvVHJhbnNjdXJyaWRvX0RIU1xuICBwdWJsaWMgb2J0ZW5lclRpZW1wb1RyYW5zY3Vycmlkb19ESFMoZmVjaGFJbmljaW86IGFueSk6IHN0cmluZyB7XG4gICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShmZWNoYUluaWNpbyk7XG4gICAgY29uc3QgZW5kID0gbmV3IERhdGUoKTtcbiAgICBsZXQgZGlmZmVyZW5jZSA9IE1hdGguYWJzKGVuZC52YWx1ZU9mKCkgLSBzdGFydC52YWx1ZU9mKCkpO1xuXG4gICAgbGV0IGRheXMgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xuICAgIGxldCBob3VycyA9IE1hdGguZmxvb3IoXG4gICAgICAoZGlmZmVyZW5jZSAlICgxMDAwICogNjAgKiA2MCAqIDI0KSkgLyAoMTAwMCAqIDYwICogNjApXG4gICAgKTtcbiAgICBsZXQgbWludXRlcyA9IE1hdGguZmxvb3IoKGRpZmZlcmVuY2UgJSAoMTAwMCAqIDYwICogNjApKSAvICgxMDAwICogNjApKTtcblxuICAgIHJldHVybiBkYXlzICsgJ2QgJyArIGhvdXJzICsgJ2ggJyArIG1pbnV0ZXMgKyAnbSc7XG4gIH1cblxuICAvLyBUT0RPOiBSZWYgY2ZuZy1jb3JlLWxpYiAtIG9idGVuZXJGb3JtYXRvRmVjaGFfRERNTVlZWVlcbiAgcHVibGljIG9idGVuZXJGb3JtYXRvRmVjaGFfRERNTVlZWVkoZGF0ZTogRGF0ZSB8IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHR5cGVvZiBkYXRlID09PSAnc3RyaW5nJykge1xuICAgICAgY29uc3QgcGFydGVzRmVjaGEgPSBkYXRlLnNwbGl0KCcvJyk7XG4gICAgICBjb25zdCBkaWEgPSBwYXJzZUludChwYXJ0ZXNGZWNoYVswXSwgMTApO1xuICAgICAgY29uc3QgbWVzID0gcGFyc2VJbnQocGFydGVzRmVjaGFbMV0sIDEwKSAtIDE7XG4gICAgICBjb25zdCBhbmlvID0gcGFyc2VJbnQocGFydGVzRmVjaGFbMl0sIDEwKTtcbiAgICAgIGRhdGUgPSBuZXcgRGF0ZShkaWEsIG1lcywgYW5pbyk7XG4gICAgfVxuICAgIGlmICghaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICBjb25zdCBkYXkgPSAoXCIwXCIgKyBkYXRlLmdldERhdGUoKSkuc2xpY2UoLTIpO1xuICAgICAgY29uc3QgbW9udGggPSAoXCIwXCIgKyAoZGF0ZS5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKTtcbiAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICByZXR1cm4gYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcignRm9ybWF0byBkZSBmZWNoYSBpbnbDoWxpZGE6IDonLCBkYXRlKTtcbiAgICAgIHJldHVybiAnLSc7XG4gICAgfVxuICB9XG5cbiAgLy8gVE9ETzogUmVmIGNmbmctY29yZS1saWIgLSB2YWxpZGFyRm9ybWF0b0hvcmFcbiAgcHVibGljIHZhbGlkYXJGb3JtYXRvSG9yYShldmVudDphbnkpOmFueSB7XG4gICAgY29uc3QgY29kZSA9IChldmVudC53aGljaCkgPyBldmVudC53aGljaCA6IGV2ZW50LmtleUNvZGU7XG4gICAgaWYoY29kZT09OCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHJldHVybiBjb2RlID49IDQ4ICYmIGNvZGUgPD0gNTg7XG4gIH1cblxuICAvLyBUT0RPOiBSZWYgY2ZuZy1jb3JlLWxpYiAtIGNhbGN1bGFyRGlhc0ZlY2hhXG4gIHB1YmxpYyBjYWxjdWxhckRpYXNGZWNoYShkYXRlOiBzdHJpbmcpIHtcbiAgICBsZXQgZGF0ZUFycmF5OiBhbnkgPSBkYXRlLnNwbGl0KFwiL1wiKTtcbiAgICByZXR1cm4gKGRhdGVBcnJheVswXSAqIDEpICsgKGRhdGVBcnJheVsxXSAqIDEpICogMzAgKyAoZGF0ZUFycmF5WzJdICogMSkgKiAzNjA7XG4gIH1cblxuICBwdWJsaWMgb2J0ZW5lckZvcm1hdG9GZWNoYUZyb21EYXRlX0RETU1ZWVlZKGZlY2hhOiBEYXRlKTogc3RyaW5nIHtcbiAgICBpZiAoZmVjaGEgIT09IHVuZGVmaW5lZCB8fCBmZWNoYSAhPT0gbnVsbCkge1xuICAgICAgbGV0IGZlID0gbmV3IERhdGUoZmVjaGEpO1xuICAgICAgY29uc3QgZGlhID0gZmUuZ2V0RGF0ZSgpO1xuICAgICAgY29uc3QgbWVzID0gZmUuZ2V0TW9udGgoKSArIDE7XG4gICAgICBjb25zdCBhbmlvID0gZmUuZ2V0RnVsbFllYXIoKTtcbiAgICAgIGNvbnN0IG1lc0Zvcm1hdGVhZG8gPSBtZXMgPCAxMCA/IGAwJHttZXN9YCA6IG1lcy50b1N0cmluZygpO1xuICAgICAgY29uc3QgZGlhRm9ybWF0ZWFkbyA9IGRpYSA8IDEwID8gYDAke2RpYX1gIDogZGlhLnRvU3RyaW5nKCk7XG4gICAgICBjb25zdCBmZWNoYUZvcm1hdGVhZGEgPSBgJHtkaWFGb3JtYXRlYWRvfS8ke21lc0Zvcm1hdGVhZG99LyR7YW5pb31gO1xuICAgICAgcmV0dXJuIGZlY2hhRm9ybWF0ZWFkYTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICctJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgKiBQZXJtaXRlIGZvcm1hdGVhciB1bmEgZmVjaGEgZW4gZm9ybWF0byBZWVlZLU1NLUREIEhIOm1tOnNzIGEgdW5hIGNhZGVuYSBlbiBmb3JtYXRvIEREIE1NIFlZWVkgSEg6bW0gYS5tLi9wLm0uIFxuICAqIEVqZW1wbG86IDIwMjMtMDUtMTUgMTQ6MzA6MDAgYSAxNSBNYXkgMjAyMyAwMjozMCBwLm0uXG4gICpcbiAgKiBAcGFyYW0gZmVjaGFIb3JhXG4gICogQHJldHVybnMgc3RyaW5nXG4gICovXG4gIHB1YmxpYyBmb3JtYXRlYXJGZWNoYUhvcmFBYnJldmlhZGEgPSAoZmVjaGFIb3JhOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuXG4gICAgaWYgKGZlY2hhSG9yYSA9PT0gbnVsbCB8fCBmZWNoYUhvcmEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuICctJztcbiAgICB9XG5cbiAgICBjb25zdCBtZXNlcyA9IFsnRW5lJywgJ0ZlYicsICdNYXInLCAnQWJyJywgJ01heScsICdKdW4nLCAnSnVsJywgJ0FnbycsICdTZXAnLCAnT2N0JywgJ05vdicsICdEaWMnXVxuXG4gICAgY29uc3QgZmVjaGEgPSBuZXcgRGF0ZShmZWNoYUhvcmEpXG5cbiAgICBpZiAoaXNOYU4oZmVjaGEuZ2V0VGltZSgpKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZvcm1hdG8gZGUgZmVjaGEgbm8gdsOhbGlkbzogXCIke2ZlY2hhSG9yYX1cIi4gU2UgZXNwZXJhYmEgdW4gZm9ybWF0byBjb21vICdZWVlZLU1NLUREJyBvICdZWVlZLU1NLUREIEhIOm1tOnNzJy5gKVxuICAgIH1cblxuICAgIGNvbnN0IGRpYSA9IGZlY2hhLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJylcbiAgICBjb25zdCBtZXMgPSBtZXNlc1tmZWNoYS5nZXRNb250aCgpXVxuICAgIGNvbnN0IGFuaW8gPSBmZWNoYS5nZXRGdWxsWWVhcigpXG5cbiAgICBjb25zdCBob3JhcyA9IGZlY2hhLmdldEhvdXJzKClcbiAgICBjb25zdCBtaW51dG9zID0gZmVjaGEuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKVxuXG4gICAgY29uc3QgcGVyaW9kbyA9IGhvcmFzID49IDEyID8gJ3AubS4nIDogJ2EubS4nO1xuICAgIGNvbnN0IGhvcmFzRm9ybWF0ZWFkYXMgPSAoaG9yYXMgJSAxMiB8fCAxMikudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpXG5cbiAgICBpZiAoZmVjaGFIb3JhLmxlbmd0aCA8PSAxMCkge1xuICAgICAgICByZXR1cm4gYCR7ZGlhfSAke21lc30gJHthbmlvfWBcbiAgICB9XG5cbiAgICByZXR1cm4gYCR7ZGlhfSAke21lc30gJHthbmlvfSAke2hvcmFzRm9ybWF0ZWFkYXN9OiR7bWludXRvc30gJHtwZXJpb2RvfWBcbiAgfVxuXG59XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREYXRlVG9BYmJyZXZpYXRlZCA9IChpbnB1dDogc3RyaW5nKSA9PiB7XG4gIGlmIChpbnB1dCA9PT0gJycgfHwgaW5wdXQgPT09IHVuZGVmaW5lZCkgcmV0dXJuICcnO1xuICBjb25zdCBtb250aHM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICAgJzAxJzogJ0VuZS4nLFxuICAgICcwMic6ICdGZWIuJyxcbiAgICAnMDMnOiAnTWFyLicsXG4gICAgJzA0JzogJ0Fici4nLFxuICAgICcwNSc6ICdNYXkuJyxcbiAgICAnMDYnOiAnSnVuLicsXG4gICAgJzA3JzogJ0p1bC4nLFxuICAgICcwOCc6ICdBZ28uJyxcbiAgICAnMDknOiAnU2VwLicsXG4gICAgJzEwJzogJ09jdC4nLFxuICAgICcxMSc6ICdOb3YuJyxcbiAgICAnMTInOiAnRGljLicsXG4gIH07XG4gIGNvbnN0IFtkYXksIG1vbnRoLCB5ZWFyXSA9IGlucHV0LnNwbGl0KCcvJyk7XG4gIGNvbnN0IGZvcm1hdHRlZE1vbnRoID0gbW9udGhzW21vbnRoXTtcbiAgcmV0dXJuIGAke3BhcnNlSW50KGRheSl9ICR7Zm9ybWF0dGVkTW9udGh9ICR7eWVhcn1gO1xufTtcblxuZXhwb3J0IGNvbnN0IGNvbnZlcnRUbzEySG91ckZvcm1hdCA9IChpbnB1dDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgaWYgKGlucHV0ID09PSAnJyB8fCBpbnB1dCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gJyc7XG4gIGNvbnN0IFtob3VyLCBtaW51dGVzXSA9IGlucHV0LnNwbGl0KCc6Jyk7XG4gIGNvbnN0IGhvdXJOdW0gPSBwYXJzZUludChob3VyKTtcbiAgY29uc3QgYW1wbSA9IGhvdXJOdW0gPj0gMTIgPyAncC5tLicgOiAnYS5tLic7XG4gIGNvbnN0IGhvdXIxMiA9IGhvdXJOdW0gPiAxMiA/IGhvdXJOdW0gLSAxMiA6IGhvdXJOdW0gPT09IDAgPyAxMiA6IGhvdXJOdW07XG4gIHJldHVybiBgJHtob3VyMTJ9OiR7bWludXRlc30gJHthbXBtfWA7XG59O1xuXG5leHBvcnQgY29uc3QgY29udmVydFRvMjRIb3VyRm9ybWF0ID0gKGlucHV0OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBbaG91cnMsIG1pbnV0ZXNdID0gaW5wdXQuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgY29uc3QgYW1wbSA9IGhvdXJzID49IDEyID8gJ3AubS4nIDogJ2EubS4nO1xuICBpZiAoaG91cnMgPT09IDAgJiYgbWludXRlcyA8IDYwKSB7XG4gICAgcmV0dXJuIGAke2hvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzXG4gICAgICAudG9TdHJpbmcoKVxuICAgICAgLnBhZFN0YXJ0KDIsICcwJyl9ICR7YW1wbX1gO1xuICB9XG4gIGxldCBob3VyczEyID0gaG91cnMgJSAxMjtcbiAgaG91cnMxMiA9IGhvdXJzMTIgPyBob3VyczEyIDogMTI7XG4gIHJldHVybiBgJHtob3VyczEyLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dGVzXG4gICAgLnRvU3RyaW5nKClcbiAgICAucGFkU3RhcnQoMiwgJzAnKX0gJHthbXBtfWA7XG59O1xuXG5leHBvcnQgY29uc3Qgb2J0ZW5lckZlY2hhTGV0cmFzID0gKGZlY2hhOiBEYXRlKTogc3RyaW5nID0+IHtcbiAgY29uc3Qgbm9tYnJlRGlhU2VtYW5hID0gZm9ybWF0KGZlY2hhLCAnRUVFRScsIHsgbG9jYWxlOiBlcyB9KTtcbiAgY29uc3QgZGlhID0gZm9ybWF0KGZlY2hhLCAnZCcsIHsgbG9jYWxlOiBlcyB9KTtcbiAgY29uc3QgbWVzID0gZm9ybWF0KGZlY2hhLCAnTU1NTScsIHsgbG9jYWxlOiBlcyB9KTtcbiAgY29uc3QgYW5obyA9IGZvcm1hdChmZWNoYSwgJ3knLCB7IGxvY2FsZTogZXMgfSk7XG4gIHJldHVybiBgJHtub21icmVEaWFTZW1hbmF9ICR7ZGlhfSBERSAke21lcy50b1VwcGVyQ2FzZSgpfSBERSAke2FuaG99YD8udG9VcHBlckNhc2UoKTtcbn07XG5cbmV4cG9ydCBjb25zdCBvYnRlbmVySG9yYUFNUE0gPSAoZmVjaGE6IERhdGUpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBob3JhID0gZ2V0SG91cnMoZmVjaGEpO1xuICBjb25zdCBtaW51dG9zID0gZ2V0TWludXRlcyhmZWNoYSk7XG4gIGNvbnN0IGFtcG0gPSBob3JhID49IDEyID8gJ1AuTS4nIDogJ0EuTS4nO1xuICBjb25zdCBob3JhMTIgPSBob3JhID4gMTIgPyBob3JhIC0gMTIgOiBob3JhID09PSAwID8gMTIgOiBob3JhO1xuICByZXR1cm4gYCR7aG9yYTEyLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW51dG9zXG4gICAgLnRvU3RyaW5nKClcbiAgICAucGFkU3RhcnQoMiwgJzAnKX0gJHthbXBtfWA7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0WVlNTURERGFzaGVkVG9ERE1NWVlTbGFzaCA9IChkYXRlU3RyOiBzdHJpbmcpID0+IHtcbiAgaWYgKCFkYXRlU3RyKSByZXR1cm4gbnVsbDtcbiAgY29uc3QgW3llYXIsIG1vbnRoLCBkYXldID0gZGF0ZVN0ci5zcGxpdCgnLScpO1xuICByZXR1cm4gYCR7ZGF5fS8ke21vbnRofS8ke3llYXJ9YDtcbn07XG5cbmV4cG9ydCBjb25zdCBvYnRlbmVyRmVjaGFERE1NWVlZWSA9IChmZWNoYTogRGF0ZSk6IHN0cmluZyA9PiB7XG4gIGNvbnN0IGRpYSA9IGZlY2hhLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gIGNvbnN0IG1lcyA9IChmZWNoYS5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICBjb25zdCBhbmhvID0gZmVjaGEuZ2V0RnVsbFllYXIoKTtcbiAgcmV0dXJuIGAke2RpYX0vJHttZXN9LyR7YW5ob31gO1xufTtcblxuZXhwb3J0IGNvbnN0IG9idGVuZXJGZWNoYVRpcG9EYXRlID0gKGZlY2hhOiBzdHJpbmcpOiBEYXRlID0+IHtcbiAgY29uc3QgcGFydGVzID0gZmVjaGEuc3BsaXQoJy8nKTtcbiAgY29uc3QgZGlhID0gcGFyc2VJbnQocGFydGVzWzBdLCAxMCk7XG4gIGNvbnN0IG1lcyA9IHBhcnNlSW50KHBhcnRlc1sxXSwgMTApIC0gMTtcbiAgY29uc3QgYW5obyA9IHBhcnNlSW50KHBhcnRlc1syXSwgMTApO1xuICByZXR1cm4gbmV3IERhdGUoYW5obywgbWVzLCBkaWEpO1xufTtcblxuZXhwb3J0IGNvbnN0IG9idGVuZXJIb3JhSEgyNE1JID0gKGZlY2hhOiBEYXRlKTogc3RyaW5nID0+IHtcbiAgY29uc3QgaG9yYXMgPSBmZWNoYS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgY29uc3QgbWludXRvcyA9IGZlY2hhLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gIHJldHVybiBgJHtob3Jhc306JHttaW51dG9zfWA7XG59O1xuXG5leHBvcnQgY29uc3Qgb2J0ZW5lckhvcmFUaXBvRGF0ZSA9IChob3JhOiBzdHJpbmcpOiBEYXRlID0+IHtcbiAgY29uc3QgW2hvcmFzLCBtaW51dG9zXSA9IGhvcmFcbiAgICAuc3BsaXQoJzonKVxuICAgIC5tYXAoKHBhcnRlcykgPT4gcGFyc2VJbnQocGFydGVzLCAxMCkpO1xuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gIHJldHVybiBuZXcgRGF0ZShcbiAgICB0b2RheS5nZXRGdWxsWWVhcigpLFxuICAgIHRvZGF5LmdldE1vbnRoKCksXG4gICAgdG9kYXkuZ2V0RGF0ZSgpLFxuICAgIGhvcmFzLFxuICAgIG1pbnV0b3NcbiAgKTtcbn07XG5cbmNvbnN0IGdldExlYWRpbmdaZXJvID0gKG51bWJlcjogbnVtYmVyKSA9PiB7XG4gIHJldHVybiBgJHtudW1iZXIgPCAxMCA/ICcwJyA6ICcnfSR7bnVtYmVyfWA7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RERNTVlZU2xhc2hUb0RETU1ZWURhc2hlZCA9IChkYXRlID0gbnVsbCkgPT4ge1xuICBjb25zdCB0b2RheSA9IGRhdGUgPyBuZXcgRGF0ZShkYXRlKSA6IG5ldyBEYXRlKCk7XG4gIGNvbnN0IGRheSA9IHRvZGF5LmdldERhdGUoKTtcbiAgY29uc3QgbW9udGggPSB0b2RheS5nZXRNb250aCgpICsgMTtcbiAgY29uc3QgeWVhciA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7XG4gIHJldHVybiBgJHtnZXRMZWFkaW5nWmVybyhkYXkpfS0ke2dldExlYWRpbmdaZXJvKG1vbnRoKX0tJHt5ZWFyfWA7XG59O1xuXG5leHBvcnQgY29uc3QgY2FsY3VsYXJUaWVtcG9SZXN0YW50ZSA9IChmZWNoYUZpbkRldGVuY2lvbjogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZmVjaGFGaW5UaW1lc3RhbXAgPSBuZXcgRGF0ZShcbiAgICBmZWNoYUZpbkRldGVuY2lvbj8ucmVwbGFjZSgvKFxcZHsyfSlcXC8oXFxkezJ9KVxcLyhcXGR7NH0pLywgJyQzLSQyLSQxJylcbiAgKS5nZXRUaW1lKCk7XG4gIGNvbnN0IGFob3JhID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gIGNvbnN0IHRpZW1wb1Jlc3RhbnRlTWlsbGlzID0gZmVjaGFGaW5UaW1lc3RhbXAgLSBhaG9yYTtcblxuICBpZiAodGllbXBvUmVzdGFudGVNaWxsaXMgPD0gMCkge1xuICAgIHJldHVybiAnQ29tcGxldGFkbyc7XG4gIH1cblxuICBjb25zdCBkaWFzID0gTWF0aC5mbG9vcih0aWVtcG9SZXN0YW50ZU1pbGxpcyAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gIGNvbnN0IGhvcmFzID0gTWF0aC5mbG9vcihcbiAgICAodGllbXBvUmVzdGFudGVNaWxsaXMgJSAoMTAwMCAqIDYwICogNjAgKiAyNCkpIC8gKDEwMDAgKiA2MCAqIDYwKVxuICApO1xuICBjb25zdCBtaW51dG9zID0gTWF0aC5mbG9vcihcbiAgICAodGllbXBvUmVzdGFudGVNaWxsaXMgJSAoMTAwMCAqIDYwICogNjApKSAvICgxMDAwICogNjApXG4gICk7XG4gIGNvbnN0IHNlZ3VuZG9zID0gTWF0aC5mbG9vcigodGllbXBvUmVzdGFudGVNaWxsaXMgJSAoMTAwMCAqIDYwKSkgLyAxMDAwKTtcblxuICBsZXQgdGllbXBvUmVzdGFudGUgPSAnJztcblxuICBpZiAoZGlhcyA+IDApIHtcbiAgICB0aWVtcG9SZXN0YW50ZSArPSBgJHtkaWFzfWRgO1xuICB9XG5cbiAgaWYgKGhvcmFzID4gMCAmJiB0aWVtcG9SZXN0YW50ZT8uc3BsaXQoJyAnKS5sZW5ndGggPCAyKSB7XG4gICAgdGllbXBvUmVzdGFudGUgKz0gYCAke2hvcmFzfWhgO1xuICB9XG5cbiAgaWYgKG1pbnV0b3MgPiAwICYmIHRpZW1wb1Jlc3RhbnRlPy50cmltKCk/LnNwbGl0KCcgJykubGVuZ3RoIDwgMikge1xuICAgIHRpZW1wb1Jlc3RhbnRlICs9IGAgJHttaW51dG9zfW1gO1xuICB9XG5cbiAgaWYgKHNlZ3VuZG9zID4gMCAmJiB0aWVtcG9SZXN0YW50ZT8udHJpbSgpPy5zcGxpdCgnICcpLmxlbmd0aCA8IDIpIHtcbiAgICB0aWVtcG9SZXN0YW50ZSArPSBgICR7c2VndW5kb3N9c2A7XG4gIH1cblxuICByZXR1cm4gYCR7dGllbXBvUmVzdGFudGU/LnRyaW0oKSB8fCAnMHMnfSBmYWx0YW50ZXNgO1xufTtcblxuZXhwb3J0IGNvbnN0IHN0cmluZzJEYXRlUmVuaWVjID0gKGZlY2hhUmVuaWVjOiBzdHJpbmcpOiBEYXRlID0+IHtcbiAgY29uc3QgW2RpYSwgbWVzLCBhbmlvXSA9IGZlY2hhUmVuaWVjLnNwbGl0KCcvJyk7XG4gIHJldHVybiBuZXcgRGF0ZSgrYW5pbywgK21lcyAtIDEsICtkaWEpO1xufTtcblxuZXhwb3J0IGNvbnN0IG9idGVuZXJGZWNoYUhvcmFERE1NWVlZWUhITU1BID0gKGZlY2hhOiBEYXRlKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZGlhID0gZmVjaGEuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgY29uc3QgbWVzID0gKGZlY2hhLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gIGNvbnN0IGFuaG8gPSBmZWNoYS5nZXRGdWxsWWVhcigpO1xuICBjb25zdCBob3JhcyA9IChmZWNoYS5nZXRIb3VycygpICUgMTIgfHwgMTIpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgY29uc3QgbWludXRvcyA9IGZlY2hhLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gIGNvbnN0IGFtcG0gPSBmZWNoYS5nZXRIb3VycygpID49IDEyID8gJ1BNJyA6ICdBTSc7XG4gIHJldHVybiBgJHtkaWF9LyR7bWVzfS8ke2FuaG99ICR7aG9yYXN9OiR7bWludXRvc30gJHthbXBtfWA7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZGF0ZVRpbWVWYWxpZGF0b3IoY29udHJvbDogRm9ybUdyb3VwKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuICBjb25zdCBkYXRlQ29udHJvbCA9IGNvbnRyb2wuZ2V0KCdmZWNoYUxsYW1hZGEnKTtcbiAgY29uc3QgdGltZUNvbnRyb2wgPSBjb250cm9sLmdldCgnaG9yYUxsYW1hZGEnKTtcblxuICBpZiAoZGF0ZUNvbnRyb2wgJiYgdGltZUNvbnRyb2wgJiYgZGF0ZUNvbnRyb2wudmFsdWUgJiYgdGltZUNvbnRyb2wudmFsdWUpIHtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZUNvbnRyb2wudmFsdWUpO1xuICAgIGNvbnN0IHRpbWUgPSBuZXcgRGF0ZSh0aW1lQ29udHJvbC52YWx1ZSk7XG5cbiAgICBkYXRlLnNldEhvdXJzKHRpbWUuZ2V0SG91cnMoKSk7XG4gICAgZGF0ZS5zZXRNaW51dGVzKHRpbWUuZ2V0TWludXRlcygpKTtcblxuICAgIC8vIEN1cnJlbnQgZGF0ZXRpbWUgZm9yIGNvbXBhcmlzb25cbiAgICBjb25zdCBjdXJyZW50RGF0ZVRpbWUgPSBuZXcgRGF0ZSgpO1xuXG4gICAgaWYgKGRhdGUgPiBjdXJyZW50RGF0ZVRpbWUpIHtcbiAgICAgIC8vIElmIHRoZSBjb21iaW5lZCBkYXRldGltZSBpcyBpbiB0aGUgZnV0dXJlLCByZXR1cm4gYW4gZXJyb3JcbiAgICAgIHJldHVybiB7IGludmFsaWREYXRlVGltZTogdHJ1ZSB9O1xuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDsgLy8gSWYgdmFsaWRhdGlvbiBwYXNzZXNcblxuICBjb25zdCBpbnB1dERhdGUgPSBuZXcgRGF0ZShjb250cm9sLnZhbHVlKTtcbiAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gIGNvbnNvbGUubG9nKGlucHV0RGF0ZSwgY3VycmVudERhdGUsIGlucHV0RGF0ZSA+IGN1cnJlbnREYXRlKTtcblxuICBpZiAoaW5wdXREYXRlID4gY3VycmVudERhdGUpIHtcbiAgICByZXR1cm4geyBmdXR1cmVEYXRlOiB0cnVlIH07XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBjb25zdCBvYnRlbmVyVGllbXBvVHJhbnNjdXJyaWRvID0gKGZlY2hhSW5pY2lhbDogRGF0ZSk6IHN0cmluZyA9PiB7XG4gIGxldCB0aW1lQWdvID0gJyc7XG4gIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTtcbiAgY29uc3QgdGltZURpZmZlcmVuY2UgPSBjdXJyZW50RGF0ZS5nZXRUaW1lKCkgLSBmZWNoYUluaWNpYWwuZ2V0VGltZSgpO1xuICBjb25zdCBzZWNvbmRzID0gTWF0aC5mbG9vcih0aW1lRGlmZmVyZW5jZSAvIDEwMDApO1xuICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApO1xuICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IobWludXRlcyAvIDYwKTtcbiAgY29uc3QgZGF5cyA9IE1hdGguZmxvb3IoaG91cnMgLyAyNCk7XG5cbiAgaWYgKGRheXMgPiAwKSB7XG4gICAgdGltZUFnbyA9IGBoYWNlICR7ZGF5c30gZMOtYShzKWA7XG4gIH0gZWxzZSBpZiAoaG91cnMgPiAwKSB7XG4gICAgdGltZUFnbyA9IGBoYWNlICR7aG91cnN9IGhvcmEocylgO1xuICB9IGVsc2UgaWYgKG1pbnV0ZXMgPiAwKSB7XG4gICAgdGltZUFnbyA9IGBoYWNlICR7bWludXRlc30gbWludXRvKHMpYDtcbiAgfSBlbHNlIHtcbiAgICB0aW1lQWdvID0gYGhhY2UgJHtzZWNvbmRzfSBzZWd1bmRvKHMpYDtcbiAgfVxuICByZXR1cm4gdGltZUFnbztcbn07XG5cbi8qKlxuICogVmFsaWRhIGVsIHJhbmdvIGRlIGZlY2hhcyBtw6F4aW1vIDEgbWVzLiBVc2FkbyBwYXJhIGxvcyBmb3JtdWxhcmlvcyByZWFjdGl2b3NcbiAqXG4gKiBAcGFyYW0gZ3JvdXBcbiAqIEByZXR1cm5zIG51bGwgfCBvYmplY3RcbiAqL1xuZXhwb3J0IGNvbnN0IHZhbGlkYXJSYW5nb0ZlY2hhRm9ybSA9IChncm91cDogRm9ybUdyb3VwKTogbnVsbCB8IG9iamVjdCA9PiB7XG4gIGNvbnN0IGZlY2hhRGVzZGUgPSBncm91cC5nZXQoJ2ZlY2hhRGVzZGUnKT8udmFsdWU7XG4gIGNvbnN0IGZlY2hhSGFzdGEgPSBncm91cC5nZXQoJ2ZlY2hhSGFzdGEnKT8udmFsdWU7XG5cbiAgaWYgKCFmZWNoYURlc2RlIHx8ICFmZWNoYUhhc3RhKSB7XG4gICAgcmV0dXJuIG51bGw7IC8vIE5vIHZhbGlkYXIgc2kgdW5hIGRlIGxhcyBmZWNoYXMgbm8gZXN0w6EgZGVmaW5pZGFcbiAgfVxuXG4gIGNvbnN0IGluaWNpbyA9IG5ldyBEYXRlKGZlY2hhRGVzZGUpO1xuICBjb25zdCBmaW4gPSBuZXcgRGF0ZShmZWNoYUhhc3RhKTtcbiAgY29uc3QgaG95ID0gbmV3IERhdGUoKTtcbiAgaWYgKCEoZmluIDw9IGhveSkpIHtcbiAgICByZXR1cm4geyByYW5nb0ZlY2hhSW52YWxpZG9NYXg6IHRydWUgfTtcbiAgfVxuXG4gIC8vIENhbGN1bGFyIGxhIGRpZmVyZW5jaWEgZW4gbWVzZXMgeSBkw61hc1xuICBjb25zdCBkaWZlcmVuY2lhTWVzZXMgPVxuICAgIGZpbi5nZXRNb250aCgpIC1cbiAgICBpbmljaW8uZ2V0TW9udGgoKSArXG4gICAgKGZpbi5nZXRGdWxsWWVhcigpIC0gaW5pY2lvLmdldEZ1bGxZZWFyKCkpICogMTI7XG4gIGNvbnN0IGRpZmVyZW5jaWFEaWFzID0gZmluLmdldERhdGUoKSAtIGluaWNpby5nZXREYXRlKCk7XG5cbiAgLy8gVmVyaWZpY2FyIHNpIGxhIGRpZmVyZW5jaWEgZXMgZXhhY3RhbWVudGUgdW4gbWVzIG8gbWVub3NcbiAgY29uc3QgcmFuZ29WYWxpZG8gPVxuICAgIChkaWZlcmVuY2lhTWVzZXMgPT09IDEgJiYgZGlmZXJlbmNpYURpYXMgPD0gMCkgfHxcbiAgICAoZGlmZXJlbmNpYU1lc2VzID09PSAwICYmIGRpZmVyZW5jaWFEaWFzID49IDApO1xuXG4gIHJldHVybiByYW5nb1ZhbGlkbyA/IG51bGwgOiB7IHJhbmdvRmVjaGFJbnZhbGlkbzogdHJ1ZSB9O1xufTtcblxuLyoqXG4gKiBWYWxpZGEgZWwgcmFuZ28gZGUgZmVjaGFzIG3DoXhpbW8gNiBtZXNlcy4gVXNhZG8gcGFyYSBsb3MgZm9ybXVsYXJpb3MgcmVhY3Rpdm9zXG4gKlxuICogQHBhcmFtIGdyb3VwXG4gKiBAcmV0dXJucyBudWxsIHwgb2JqZWN0XG4gKi9cbmV4cG9ydCBjb25zdCB2YWxpZGFyUmFuZ29VbHRpbW82TWVzZXNGb3JtID0gKFxuICBncm91cDogRm9ybUdyb3VwXG4pOiBudWxsIHwgb2JqZWN0ID0+IHtcbiAgY29uc3QgZmVjaGFEZXNkZSA9IGdyb3VwLmdldCgnZmVjaGFEZXNkZScpPy52YWx1ZTtcbiAgY29uc3QgZmVjaGFIYXN0YSA9IGdyb3VwLmdldCgnZmVjaGFIYXN0YScpPy52YWx1ZTtcblxuICBpZiAoIWZlY2hhRGVzZGUgfHwgIWZlY2hhSGFzdGEpIHtcbiAgICByZXR1cm4gbnVsbDsgLy8gTm8gdmFsaWRhciBzaSB1bmEgZGUgbGFzIGZlY2hhcyBubyBlc3TDoSBkZWZpbmlkYVxuICB9XG5cbiAgY29uc3QgaW5pY2lvID0gbmV3IERhdGUoZmVjaGFEZXNkZSk7XG4gIGNvbnN0IGZpbiA9IG5ldyBEYXRlKGZlY2hhSGFzdGEpO1xuICBjb25zdCBob3kgPSBuZXcgRGF0ZSgpO1xuICBpZiAoIShmaW4gPD0gaG95KSkge1xuICAgIHJldHVybiB7IHJhbmdvRmVjaGFJbnZhbGlkb01heDogdHJ1ZSB9O1xuICB9XG5cbiAgLy8gQ2FsY3VsYXIgbGEgZGlmZXJlbmNpYSBlbiBtZXNlcyB5IGTDrWFzXG4gIGxldCBkaWZlcmVuY2lhTWVzZXMgPVxuICAgIGZpbi5nZXRNb250aCgpIC1cbiAgICBpbmljaW8uZ2V0TW9udGgoKSArXG4gICAgKGZpbi5nZXRGdWxsWWVhcigpIC0gaW5pY2lvLmdldEZ1bGxZZWFyKCkpICogMTI7XG4gIGxldCBkaWZlcmVuY2lhRGlhcyA9IGZpbi5nZXREYXRlKCkgLSBpbmljaW8uZ2V0RGF0ZSgpO1xuXG4gIC8vIEFqdXN0YXIgbGEgZGlmZXJlbmNpYSBkZSBkw61hcyBzaSBlcyBuZWdhdGl2YVxuICBpZiAoZGlmZXJlbmNpYURpYXMgPCAwKSB7XG4gICAgZGlmZXJlbmNpYU1lc2VzIC09IDE7XG4gICAgZGlmZXJlbmNpYURpYXMgKz0gMzA7XG4gIH1cblxuICAvLyBWZXJpZmljYXIgc2kgbGEgZGlmZXJlbmNpYSBlcyBkZSA2IG1lc2VzIG8gbWVub3MgeSBsb3MgZMOtYXMgbm8gZXhjZWRlbiBlbCByYW5nb1xuICBjb25zdCByYW5nb1ZhbGlkbyA9XG4gICAgZGlmZXJlbmNpYU1lc2VzIDwgNiB8fCAoZGlmZXJlbmNpYU1lc2VzID09PSA2ICYmIGRpZmVyZW5jaWFEaWFzIDw9IDApO1xuXG4gIHJldHVybiByYW5nb1ZhbGlkbyA/IG51bGwgOiB7IHJhbmdvRmVjaGFJbnZhbGlkbzogdHJ1ZSB9O1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJhbmdvRmVjaGFYRGVmZWN0bygpIHtcbiAgY29uc3QgbWVzZXMgPVxuICAgIENPTlNVTFRBX0NBU09fUkFOR09fRkVDSEE7IC8qU2UgcmVzdGEgNiBtZXNlcyBhIGxhIGZlY2hhIGFjdHVhbCAqL1xuICBjb25zdCBmZWNoYUZpbiA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IGZlY2hhSW5pY2lvID0gbmV3IERhdGUoZmVjaGFGaW4pO1xuICBjb25zdCBtZXNJbmljaW8gPSBmZWNoYUluaWNpby5nZXRNb250aCgpO1xuICBmZWNoYUluaWNpby5zZXRNb250aChmZWNoYUZpbi5nZXRNb250aCgpIC0gbWVzZXMpO1xuXG4gIC8vIEFqdXN0ZSBwYXJhIGNhc29zIGVuIGxvcyBxdWUgcmVzdGFyIG1lc2VzIGNhbWJpZSBlbCBhw7FvIHkgY2F1c2UgdW4gcHJvYmxlbWEgZGUgZGVzYm9yZGFtaWVudG9cbiAgaWYgKGZlY2hhSW5pY2lvLmdldE1vbnRoKCkgIT09ICgoKG1lc0luaWNpbyAtIG1lc2VzKSAlIDEyKSArIDEyKSAlIDEyKSB7XG4gICAgZmVjaGFJbmljaW8uc2V0RGF0ZSgwKTsgLy8gRXN0YWJsZWNlIGFsIMO6bHRpbW8gZMOtYSBkZWwgbWVzIGFudGVyaW9yXG4gIH1cbiAgcmV0dXJuIHtcbiAgICBpbmljaW86IGZlY2hhSW5pY2lvLFxuICAgIGZpbjogZmVjaGFGaW4sXG4gIH07XG59Il19