import { etapaInfo } from '../constant/menu-constant';
export const cleanEmptyFields = (object) => {
    const request = Object.fromEntries(Object.entries(object).filter(([_, valor]) => valor !== null && valor !== undefined && valor !== ''));
    return request;
};
export const obtenerCasoHtml = (numeroCaso) => {
    const caso = numeroCaso?.split('-');
    return `<span class="cfe-caso" style="white-space: nowrap">${caso[0]}-<span>${caso[1]}-${caso[2]}</span>-${caso[3]}</span>`;
};
export const obtenerRutaParaEtapa = (etapa) => {
    return etapaInfo(etapa).path;
};
export const obtenerTipoOpcionEtapa = (etapa) => {
    return etapaInfo(etapa).tipoOpcion;
};
export const urlEditarTramite = (tramite) => {
    return `app/administracion-casos/consultar-casos-fiscales/${obtenerRutaParaEtapa(tramite.idEtapa)}/caso/${tramite.idCaso}/acto-procesal/${tramite.idActoTramiteCaso}`;
};
export function limmpiarTildes(str) {
    return str.normalize('NFD').replaceAll(/[\u0300-\u036f]/g, '');
}
export const noQuotes = (event) => {
    const charCode = event.charCode || event.keyCode || 0;
    const key = String.fromCharCode(charCode);
    if (key === "'" || key === '"') {
        return false;
    }
    return true;
};
export const validOnlyNumbers = (event) => {
    const charCode = event.which ? event.which : event.keyCode;
    if (charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    }
    return true;
};
export const validLongitud = (event, maxLen) => {
    const input = event.target;
    const inputLength = input.value.length;
    const isArrowKey = event.key === 'ArrowRight' || event.key === 'ArrowLeft';
    const isBackspaceOrTab = event.key === 'Backspace' || event.key === 'Tab';
    const isDeleteKey = event.key === 'Delete';
    // Permitir Supr (Delete) independientemente de la longitud máxima
    if (isDeleteKey) {
        return;
    }
    if (!isArrowKey && inputLength >= maxLen && !isBackspaceOrTab) {
        event.preventDefault();
    }
};
export const validAlfanumerica = (event) => {
    const tecla = event.key;
    const esAlfanumerico = /^[a-zA-Z0-9]$/;
    if (!esAlfanumerico.test(tecla)) {
        event.preventDefault(); // Evita que se ingrese el carácter
    }
};
export const obtenerCodigoCasoHtml = (numeroCaso) => {
    const caso = numeroCaso?.split('-');
    return `<div class="cfe-caso">${caso[0]}-${caso[1]}-<span>${caso[2]}-${caso[3]}</span></div>`;
};
export const formatDate = (date) => {
    return date
        ? date.toLocaleDateString('es-ES', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
        })
        : '';
};
export const formatDatetime = (date) => {
    return date
        ? date.toLocaleDateString('es-ES', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
        })
        : '';
};
export const formatStringDatetime = (date, hour) => {
    const dateFormatted = date
        ? date.toLocaleDateString('es-ES', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
        })
        : '';
    const hourFormatted = hour
        ? `${hour.getHours().toString().padStart(2, '0')}:${hour
            .getMinutes()
            .toString()
            .padStart(2, '0')}`
        : '';
    const format = `${dateFormatted} ${hourFormatted}`;
    return format;
};
export const formatTime = (hour) => {
    const hourFormatted = hour
        ? `${hour.getHours().toString().padStart(2, '0')}:${hour
            .getMinutes()
            .toString()
            .padStart(2, '0')}:${hour.getSeconds().toString().padStart(2, '0')}`
        : '';
    return hourFormatted;
};
export const formatTimeHHMM = (hour) => {
    const hourFormatted = hour
        ? `${hour.getHours().toString().padStart(2, '0')}:${hour
            .getMinutes()
            .toString()
            .padStart(2, '0')}`
        : '';
    return hourFormatted;
};
export const getValidString = (value) => {
    return value !== null && value !== undefined
        ? String(value).trim() !== ''
            ? String(value).trim().toUpperCase()
            : null
        : null;
};
export const validText = (event, customPattern = /^[A-Za-zÁÉÍÓÚáéíóúñÑ ]+$/) => {
    const charCode = event.which ? event.which : event.keyCode;
    if (charCode == 8) {
        return true;
    }
    const pattern = customPattern;
    const character = String.fromCharCode(charCode);
    return pattern.test(character);
};
export const validOnlyTextOnPaste = (event) => {
    const clipboardData = event.clipboardData || window['clipboardData'];
    const pastedText = clipboardData.getData('text');
    const validText = pastedText.match(/[A-Za-zÁÉÍÓÚáéíóúñÑ ]+/g)?.join('');
    const newPastedText = validText ?? '';
    if (!/^[A-Za-zÁÉÍÓÚáéíóúñÑ ]+$/.test(pastedText)) {
        event.preventDefault();
        const element = event.target;
        if (element.isContentEditable) {
            const selection = window.getSelection();
            if (selection) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(newPastedText));
            }
        }
        else {
            element.value = newPastedText;
            element.dispatchEvent(new Event('input'));
        }
    }
};
export const validOnlyNumberOnPaste = (event) => {
    const clipboardData = event.clipboardData || window['clipboardData'];
    const pastedText = clipboardData.getData('text');
    const numericText = pastedText.match(/\d+/g)?.join('');
    const newPastedText = numericText ?? '';
    if (!/^\d+$/.test(pastedText)) {
        event.preventDefault();
        const element = event.target;
        if (element.isContentEditable) {
            const selection = window.getSelection();
            if (selection) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(newPastedText));
            }
        }
        else {
            element.value = newPastedText;
            element.dispatchEvent(new Event('input'));
        }
    }
};
export const validAlfanumericaOnPaste = (event) => {
    const textoPegado = event.clipboardData?.getData('text');
    const esAlfanumerico = /^[a-zA-Z0-9]*$/;
    if (textoPegado && !esAlfanumerico.test(textoPegado)) {
        event.preventDefault();
    }
};
export const formatDateText = (value) => {
    const [date, time] = value.split(' ');
    const [hour, minute] = time.split(':');
    let formattedHour = Number(hour);
    let meridiem = 'AM';
    if (formattedHour >= 12) {
        formattedHour = formattedHour % 12;
        meridiem = 'PM';
    }
    if (formattedHour === 0) {
        formattedHour = 12;
    }
    return `${date} a las ${formattedHour
        .toString()
        .padStart(2, '0')}:${minute} ${meridiem}`;
};
export const getDateFromString = (value) => {
    if (value === null)
        return null;
    const [day, month, year] = value.split('/').map(Number);
    const date = new Date(year, month - 1, day);
    return date;
};
export const formatDateString = (value) => {
    const [year, month, day] = value.split('-');
    const date = day + '/' + month + '/' + year;
    return date;
};
export const validateDateTime = (dateTimeString) => {
    const [dateComponents, timeComponents] = dateTimeString.split(' ');
    const [day, month, year] = dateComponents.split('/');
    const [hours, minutes, seconds] = timeComponents.split(':');
    const selectedDateTime = new Date(+year, +month - 1, +day, +hours, +minutes, +seconds);
    const currentDateTime = new Date();
    return selectedDateTime <= currentDateTime;
};
export function getCapitalized(text = '') {
    if (typeof text !== 'string') {
        return '';
    }
    const word = text.toLowerCase().split(' ');
    for (let i = 0; i < word.length; i++) {
        word[i] = word[i].charAt(0).toUpperCase() + word[i].slice(1);
    }
    return word.join(' ');
}
export function actualizarContadorInputTextArea(maximo, texto) {
    return 1000 - texto.length;
}
export default {
    getCapitalized,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMtdXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1jZm5nLWNvcmUtbGliL3V0aWwvdXRpbHMtdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQXdCLFNBQVMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRTVFLE1BQU0sQ0FBQyxNQUFNLGdCQUFnQixHQUFHLENBQUMsTUFBYyxFQUFFLEVBQUU7SUFDakQsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FDaEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQzNCLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssRUFBRSxDQUN0RSxDQUNGLENBQUM7SUFDRixPQUFPLE9BQU8sQ0FBQztBQUNqQixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsQ0FBQyxVQUFrQixFQUFVLEVBQUU7SUFDNUQsTUFBTSxJQUFJLEdBQUcsVUFBVSxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQyxPQUFPLHNEQUFzRCxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUM5SCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEtBQWEsRUFBVSxFQUFFO0lBQzVELE9BQU8sU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztBQUMvQixDQUFDLENBQUM7QUFDRixNQUFNLENBQUMsTUFBTSxzQkFBc0IsR0FBRyxDQUFDLEtBQWEsRUFBd0IsRUFBRTtJQUM1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TSxVQUFVLGNBQWMsQ0FBQyxJQUFJLEdBQUcsRUFBRTtJQUN0QyxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzdCLE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUNELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0MsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDeEIsQ0FBQztBQUVELE1BQU0sVUFBVSwrQkFBK0IsQ0FDN0MsTUFBYyxFQUNkLEtBQWE7SUFFYixPQUFPLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO0FBQzdCLENBQUM7QUFFRCxlQUFlO0lBQ2IsY0FBYztDQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYW5kZWphVHJhbWl0ZSB9IGZyb20gJy4uL2ludGVyZmFjZXMvcHJvdmluY2lhbC9iYW5kZWphLXRyYW1pdGVzL0JhbmRlamFUcmFtaXRlLWludGVyZmFjZSc7XG5pbXBvcnQgeyBUaXBvT3BjaW9uQ2Fzb0Zpc2NhbCwgZXRhcGFJbmZvIH0gZnJvbSAnLi4vY29uc3RhbnQvbWVudS1jb25zdGFudCc7XG5cbmV4cG9ydCBjb25zdCBjbGVhbkVtcHR5RmllbGRzID0gKG9iamVjdDogT2JqZWN0KSA9PiB7XG4gIGNvbnN0IHJlcXVlc3QgPSBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMob2JqZWN0KS5maWx0ZXIoXG4gICAgICAoW18sIHZhbG9yXSkgPT4gdmFsb3IgIT09IG51bGwgJiYgdmFsb3IgIT09IHVuZGVmaW5lZCAmJiB2YWxvciAhPT0gJydcbiAgICApXG4gICk7XG4gIHJldHVybiByZXF1ZXN0O1xufTtcblxuZXhwb3J0IGNvbnN0IG9idGVuZXJDYXNvSHRtbCA9IChudW1lcm9DYXNvOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBjYXNvID0gbnVtZXJvQ2Fzbz8uc3BsaXQoJy0nKTtcbiAgcmV0dXJuIGA8c3BhbiBjbGFzcz1cImNmZS1jYXNvXCIgc3R5bGU9XCJ3aGl0ZS1zcGFjZTogbm93cmFwXCI+JHtjYXNvWzBdfS08c3Bhbj4ke2Nhc29bMV19LSR7Y2Fzb1syXX08L3NwYW4+LSR7Y2Fzb1szXX08L3NwYW4+YDtcbn07XG5cbmV4cG9ydCBjb25zdCBvYnRlbmVyUnV0YVBhcmFFdGFwYSA9IChldGFwYTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGV0YXBhSW5mbyhldGFwYSkucGF0aDtcbn07XG5leHBvcnQgY29uc3Qgb2J0ZW5lclRpcG9PcGNpb25FdGFwYSA9IChldGFwYTogc3RyaW5nKTogVGlwb09wY2lvbkNhc29GaXNjYWwgPT4ge1xuICByZXR1cm4gZXRhcGFJbmZvKGV0YXBhKS50aXBvT3BjaW9uO1xufTtcblxuZXhwb3J0IGNvbnN0IHVybEVkaXRhclRyYW1pdGUgPSAodHJhbWl0ZTogQmFuZGVqYVRyYW1pdGUpID0+IHtcbiAgcmV0dXJuIGBhcHAvYWRtaW5pc3RyYWNpb24tY2Fzb3MvY29uc3VsdGFyLWNhc29zLWZpc2NhbGVzLyR7b2J0ZW5lclJ1dGFQYXJhRXRhcGEoXG4gICAgdHJhbWl0ZS5pZEV0YXBhXG4gICl9L2Nhc28vJHt0cmFtaXRlLmlkQ2Fzb30vYWN0by1wcm9jZXNhbC8ke3RyYW1pdGUuaWRBY3RvVHJhbWl0ZUNhc299YDtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBsaW1tcGlhclRpbGRlcyhzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBzdHIubm9ybWFsaXplKCdORkQnKS5yZXBsYWNlQWxsKC9bXFx1MDMwMC1cXHUwMzZmXS9nLCAnJyk7XG59XG5cbmV4cG9ydCBjb25zdCBub1F1b3RlcyA9IChldmVudDogYW55KTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IGNoYXJDb2RlID0gZXZlbnQuY2hhckNvZGUgfHwgZXZlbnQua2V5Q29kZSB8fCAwO1xuICBjb25zdCBrZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXJDb2RlKTtcblxuICBpZiAoa2V5ID09PSBcIidcIiB8fCBrZXkgPT09ICdcIicpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5cbmV4cG9ydCBjb25zdCB2YWxpZE9ubHlOdW1iZXJzID0gKGV2ZW50OiBhbnkpOiBib29sZWFuID0+IHtcbiAgY29uc3QgY2hhckNvZGUgPSBldmVudC53aGljaCA/IGV2ZW50LndoaWNoIDogZXZlbnQua2V5Q29kZTtcblxuICBpZiAoY2hhckNvZGUgPiAzMSAmJiAoY2hhckNvZGUgPCA0OCB8fCBjaGFyQ29kZSA+IDU3KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkTG9uZ2l0dWQgPSAoZXZlbnQ6IEtleWJvYXJkRXZlbnQsIG1heExlbjogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gIGNvbnN0IGlucHV0TGVuZ3RoID0gaW5wdXQudmFsdWUubGVuZ3RoO1xuICBjb25zdCBpc0Fycm93S2V5ID0gZXZlbnQua2V5ID09PSAnQXJyb3dSaWdodCcgfHwgZXZlbnQua2V5ID09PSAnQXJyb3dMZWZ0JztcbiAgY29uc3QgaXNCYWNrc3BhY2VPclRhYiA9IGV2ZW50LmtleSA9PT0gJ0JhY2tzcGFjZScgfHwgZXZlbnQua2V5ID09PSAnVGFiJztcbiAgY29uc3QgaXNEZWxldGVLZXkgPSBldmVudC5rZXkgPT09ICdEZWxldGUnO1xuXG4gIC8vIFBlcm1pdGlyIFN1cHIgKERlbGV0ZSkgaW5kZXBlbmRpZW50ZW1lbnRlIGRlIGxhIGxvbmdpdHVkIG3DoXhpbWFcbiAgaWYgKGlzRGVsZXRlS2V5KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCFpc0Fycm93S2V5ICYmIGlucHV0TGVuZ3RoID49IG1heExlbiAmJiAhaXNCYWNrc3BhY2VPclRhYikge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IHZhbGlkQWxmYW51bWVyaWNhID0gKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCA9PiB7XG4gIGNvbnN0IHRlY2xhID0gZXZlbnQua2V5O1xuICBjb25zdCBlc0FsZmFudW1lcmljbyA9IC9eW2EtekEtWjAtOV0kLztcblxuICBpZiAoIWVzQWxmYW51bWVyaWNvLnRlc3QodGVjbGEpKSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgIC8vIEV2aXRhIHF1ZSBzZSBpbmdyZXNlIGVsIGNhcsOhY3RlclxuICB9XG59XG5cblxuXG5cblxuXG5leHBvcnQgY29uc3Qgb2J0ZW5lckNvZGlnb0Nhc29IdG1sID0gKG51bWVyb0Nhc286IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIGNvbnN0IGNhc28gPSBudW1lcm9DYXNvPy5zcGxpdCgnLScpO1xuICByZXR1cm4gYDxkaXYgY2xhc3M9XCJjZmUtY2Fzb1wiPiR7Y2Fzb1swXX0tJHtjYXNvWzFdfS08c3Bhbj4ke2Nhc29bMl19LSR7Y2Fzb1szXX08L3NwYW4+PC9kaXY+YDtcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREYXRlID0gKGRhdGU6IERhdGUpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gZGF0ZVxuICAgID8gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoJ2VzLUVTJywge1xuICAgICAgZGF5OiAnMi1kaWdpdCcsXG4gICAgICBtb250aDogJzItZGlnaXQnLFxuICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgIH0pXG4gICAgOiAnJztcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREYXRldGltZSA9IChkYXRlOiBEYXRlKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGRhdGVcbiAgICA/IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdlcy1FUycsIHtcbiAgICAgIGRheTogJzItZGlnaXQnLFxuICAgICAgbW9udGg6ICcyLWRpZ2l0JyxcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgIGhvdXI6ICcyLWRpZ2l0JyxcbiAgICAgIG1pbnV0ZTogJzItZGlnaXQnLFxuICAgIH0pXG4gICAgOiAnJztcbn07XG5cbmV4cG9ydCBjb25zdCBmb3JtYXRTdHJpbmdEYXRldGltZSA9IChkYXRlOiBEYXRlLCBob3VyOiBEYXRlKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZGF0ZUZvcm1hdHRlZCA9IGRhdGVcbiAgICA/IGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCdlcy1FUycsIHtcbiAgICAgIGRheTogJzItZGlnaXQnLFxuICAgICAgbW9udGg6ICcyLWRpZ2l0JyxcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICB9KVxuICAgIDogJyc7XG4gIGNvbnN0IGhvdXJGb3JtYXR0ZWQgPSBob3VyXG4gICAgPyBgJHtob3VyLmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke2hvdXJcbiAgICAgIC5nZXRNaW51dGVzKClcbiAgICAgIC50b1N0cmluZygpXG4gICAgICAucGFkU3RhcnQoMiwgJzAnKX1gXG4gICAgOiAnJztcbiAgY29uc3QgZm9ybWF0ID0gYCR7ZGF0ZUZvcm1hdHRlZH0gJHtob3VyRm9ybWF0dGVkfWA7XG4gIHJldHVybiBmb3JtYXQ7XG59O1xuXG5leHBvcnQgY29uc3QgZm9ybWF0VGltZSA9IChob3VyOiBEYXRlKTogc3RyaW5nID0+IHtcbiAgY29uc3QgaG91ckZvcm1hdHRlZCA9IGhvdXJcbiAgICA/IGAke2hvdXIuZ2V0SG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7aG91clxuICAgICAgLmdldE1pbnV0ZXMoKVxuICAgICAgLnRvU3RyaW5nKClcbiAgICAgIC5wYWRTdGFydCgyLCAnMCcpfToke2hvdXIuZ2V0U2Vjb25kcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gXG4gICAgOiAnJztcbiAgcmV0dXJuIGhvdXJGb3JtYXR0ZWQ7XG59O1xuZXhwb3J0IGNvbnN0IGZvcm1hdFRpbWVISE1NID0gKGhvdXI6IERhdGUpOiBzdHJpbmcgPT4ge1xuICBjb25zdCBob3VyRm9ybWF0dGVkID0gaG91clxuICAgID8gYCR7aG91ci5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtob3VyXG4gICAgICAuZ2V0TWludXRlcygpXG4gICAgICAudG9TdHJpbmcoKVxuICAgICAgLnBhZFN0YXJ0KDIsICcwJyl9YFxuICAgIDogJyc7XG5cbiAgcmV0dXJuIGhvdXJGb3JtYXR0ZWQ7XG59O1xuZXhwb3J0IGNvbnN0IGdldFZhbGlkU3RyaW5nID0gKHZhbHVlOiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCA9PiB7XG4gIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkXG4gICAgPyBTdHJpbmcodmFsdWUpLnRyaW0oKSAhPT0gJydcbiAgICAgID8gU3RyaW5nKHZhbHVlKS50cmltKCkudG9VcHBlckNhc2UoKVxuICAgICAgOiBudWxsXG4gICAgOiBudWxsO1xufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkVGV4dCA9IChcbiAgZXZlbnQ6IGFueSxcbiAgY3VzdG9tUGF0dGVybjogYW55ID0gL15bQS1aYS16w4HDicONw5PDmsOhw6nDrcOzw7rDscORIF0rJC9cbikgPT4ge1xuICBjb25zdCBjaGFyQ29kZSA9IGV2ZW50LndoaWNoID8gZXZlbnQud2hpY2ggOiBldmVudC5rZXlDb2RlO1xuICBpZiAoY2hhckNvZGUgPT0gOCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHBhdHRlcm4gPSBjdXN0b21QYXR0ZXJuO1xuICBjb25zdCBjaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXJDb2RlKTtcbiAgcmV0dXJuIHBhdHRlcm4udGVzdChjaGFyYWN0ZXIpO1xufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkT25seVRleHRPblBhc3RlID0gKGV2ZW50OiBhbnkpID0+IHtcbiAgY29uc3QgY2xpcGJvYXJkRGF0YSA9IGV2ZW50LmNsaXBib2FyZERhdGEgfHwgKHdpbmRvdyBhcyBhbnkpWydjbGlwYm9hcmREYXRhJ107XG4gIGNvbnN0IHBhc3RlZFRleHQgPSBjbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKTtcbiAgY29uc3QgdmFsaWRUZXh0ID0gcGFzdGVkVGV4dC5tYXRjaCgvW0EtWmEtesOBw4nDjcOTw5rDocOpw63Ds8O6w7HDkSBdKy9nKT8uam9pbignJyk7XG4gIGNvbnN0IG5ld1Bhc3RlZFRleHQgPSB2YWxpZFRleHQgPz8gJyc7XG4gIGlmICghL15bQS1aYS16w4HDicONw5PDmsOhw6nDrcOzw7rDscORIF0rJC8udGVzdChwYXN0ZWRUZXh0KSkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgZWxlbWVudCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGlmIChlbGVtZW50LmlzQ29udGVudEVkaXRhYmxlKSB7XG4gICAgICBjb25zdCBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICBpZiAoc2VsZWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XG4gICAgICAgIHJhbmdlLmRlbGV0ZUNvbnRlbnRzKCk7XG4gICAgICAgIHJhbmdlLmluc2VydE5vZGUoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobmV3UGFzdGVkVGV4dCkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LnZhbHVlID0gbmV3UGFzdGVkVGV4dDtcbiAgICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2lucHV0JykpO1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkT25seU51bWJlck9uUGFzdGUgPSAoZXZlbnQ6IGFueSkgPT4ge1xuICBjb25zdCBjbGlwYm9hcmREYXRhID0gZXZlbnQuY2xpcGJvYXJkRGF0YSB8fCAod2luZG93IGFzIGFueSlbJ2NsaXBib2FyZERhdGEnXTtcbiAgY29uc3QgcGFzdGVkVGV4dCA9IGNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dCcpO1xuICBjb25zdCBudW1lcmljVGV4dCA9IHBhc3RlZFRleHQubWF0Y2goL1xcZCsvZyk/LmpvaW4oJycpO1xuICBjb25zdCBuZXdQYXN0ZWRUZXh0ID0gbnVtZXJpY1RleHQgPz8gJyc7XG5cbiAgaWYgKCEvXlxcZCskLy50ZXN0KHBhc3RlZFRleHQpKSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBlbGVtZW50ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgaWYgKGVsZW1lbnQuaXNDb250ZW50RWRpdGFibGUpIHtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIGlmIChzZWxlY3Rpb24pIHtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKTtcbiAgICAgICAgcmFuZ2UuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgcmFuZ2UuaW5zZXJ0Tm9kZShkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShuZXdQYXN0ZWRUZXh0KSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQudmFsdWUgPSBuZXdQYXN0ZWRUZXh0O1xuICAgICAgZWxlbWVudC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnaW5wdXQnKSk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgdmFsaWRBbGZhbnVtZXJpY2FPblBhc3RlID0gKGV2ZW50OiBDbGlwYm9hcmRFdmVudCk6IHZvaWQgPT4ge1xuICBjb25zdCB0ZXh0b1BlZ2FkbyA9IGV2ZW50LmNsaXBib2FyZERhdGE/LmdldERhdGEoJ3RleHQnKTtcbiAgY29uc3QgZXNBbGZhbnVtZXJpY28gPSAvXlthLXpBLVowLTldKiQvO1xuXG4gIGlmICh0ZXh0b1BlZ2FkbyAmJiAhZXNBbGZhbnVtZXJpY28udGVzdCh0ZXh0b1BlZ2FkbykpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBmb3JtYXREYXRlVGV4dCA9ICh2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgW2RhdGUsIHRpbWVdID0gdmFsdWUuc3BsaXQoJyAnKTtcbiAgY29uc3QgW2hvdXIsIG1pbnV0ZV0gPSB0aW1lLnNwbGl0KCc6Jyk7XG5cbiAgbGV0IGZvcm1hdHRlZEhvdXIgPSBOdW1iZXIoaG91cik7XG4gIGxldCBtZXJpZGllbSA9ICdBTSc7XG5cbiAgaWYgKGZvcm1hdHRlZEhvdXIgPj0gMTIpIHtcbiAgICBmb3JtYXR0ZWRIb3VyID0gZm9ybWF0dGVkSG91ciAlIDEyO1xuICAgIG1lcmlkaWVtID0gJ1BNJztcbiAgfVxuXG4gIGlmIChmb3JtYXR0ZWRIb3VyID09PSAwKSB7XG4gICAgZm9ybWF0dGVkSG91ciA9IDEyO1xuICB9XG5cbiAgcmV0dXJuIGAke2RhdGV9IGEgbGFzICR7Zm9ybWF0dGVkSG91clxuICAgIC50b1N0cmluZygpXG4gICAgLnBhZFN0YXJ0KDIsICcwJyl9OiR7bWludXRlfSAke21lcmlkaWVtfWA7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RGF0ZUZyb21TdHJpbmcgPSAodmFsdWU6IHN0cmluZyk6IERhdGUgfCBudWxsID0+IHtcbiAgaWYgKHZhbHVlID09PSBudWxsKSByZXR1cm4gbnVsbDtcblxuICBjb25zdCBbZGF5LCBtb250aCwgeWVhcl0gPSB2YWx1ZS5zcGxpdCgnLycpLm1hcChOdW1iZXIpO1xuICBjb25zdCBkYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXkpO1xuXG4gIHJldHVybiBkYXRlO1xufTtcblxuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGVTdHJpbmcgPSAodmFsdWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gIGNvbnN0IFt5ZWFyLCBtb250aCwgZGF5XSA9IHZhbHVlLnNwbGl0KCctJyk7XG4gIGNvbnN0IGRhdGUgPSBkYXkgKyAnLycgKyBtb250aCArICcvJyArIHllYXI7XG4gIHJldHVybiBkYXRlO1xufTtcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlRGF0ZVRpbWUgPSAoZGF0ZVRpbWVTdHJpbmc6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICBjb25zdCBbZGF0ZUNvbXBvbmVudHMsIHRpbWVDb21wb25lbnRzXSA9IGRhdGVUaW1lU3RyaW5nLnNwbGl0KCcgJyk7XG4gIGNvbnN0IFtkYXksIG1vbnRoLCB5ZWFyXSA9IGRhdGVDb21wb25lbnRzLnNwbGl0KCcvJyk7XG4gIGNvbnN0IFtob3VycywgbWludXRlcywgc2Vjb25kc10gPSB0aW1lQ29tcG9uZW50cy5zcGxpdCgnOicpO1xuICBjb25zdCBzZWxlY3RlZERhdGVUaW1lID0gbmV3IERhdGUoXG4gICAgK3llYXIsXG4gICAgK21vbnRoIC0gMSxcbiAgICArZGF5LFxuICAgICtob3VycyxcbiAgICArbWludXRlcyxcbiAgICArc2Vjb25kc1xuICApO1xuICBjb25zdCBjdXJyZW50RGF0ZVRpbWUgPSBuZXcgRGF0ZSgpO1xuICByZXR1cm4gc2VsZWN0ZWREYXRlVGltZSA8PSBjdXJyZW50RGF0ZVRpbWU7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FwaXRhbGl6ZWQodGV4dCA9ICcnKSB7XG4gIGlmICh0eXBlb2YgdGV4dCAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cbiAgY29uc3Qgd29yZCA9IHRleHQudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmQubGVuZ3RoOyBpKyspIHtcbiAgICB3b3JkW2ldID0gd29yZFtpXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHdvcmRbaV0uc2xpY2UoMSk7XG4gIH1cbiAgcmV0dXJuIHdvcmQuam9pbignICcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWN0dWFsaXphckNvbnRhZG9ySW5wdXRUZXh0QXJlYShcbiAgbWF4aW1vOiBudW1iZXIsXG4gIHRleHRvOiBzdHJpbmdcbik6IG51bWJlciB7XG4gIHJldHVybiAxMDAwIC0gdGV4dG8ubGVuZ3RoO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldENhcGl0YWxpemVkLFxufTtcbiJdfQ==