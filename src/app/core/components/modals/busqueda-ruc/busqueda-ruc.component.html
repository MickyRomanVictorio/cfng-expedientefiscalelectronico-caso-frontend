<div class="registrar-ruc">
    <div class="modal__header">
        <div class="modal_header__content">
            <div class="cfe-titulo-1">Buscar Sujeto</div>
        </div>
        <div class="flex align-items-center justify-content-center">
            <p-button (click)="referenciaModal.close()" icon="pi pi-times"
                styleClass="p-button-rounded text-color p-button-text" onKeyPress></p-button>
        </div>
    </div>

    <div [formGroup]="form" class="ruc-modal">
        <div class="body mt-2">
            <div class="formgrid grid">
                <div class="field col">
                    <div class="flex gap-4 text-sm">
                        <div class="flex align-items-center">
                            <label id="xRUC" class="cfe-semi-bold">
                                <p-radioButton name="tipoBusqueda" [value]="tipoBusqueda.RUC"
                                    formControlName="tipoBusqueda"></p-radioButton>
                                RUC</label>
                        </div>
                        <div class="flex align-items-center">
                            <label id="xRS" class="cfe-semi-bold">
                                <p-radioButton name="tipoBusqueda" [value]="tipoBusqueda.RAZON_SOCIAL"
                                    formControlName="tipoBusqueda"></p-radioButton>
                                RAZÓN SOCIAL</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="formgrid grid">
                <div class="field col-12">
                    <label class="font-bold text-sm"> {{ tituloInput }}</label>
                </div>
                <div class="field col-7">
                    <input (input)="esBusquedaPorRuc ?validaNumerosPorRUC($event):null;" upperCaseInput [attr.maxlength]="esBusquedaPorRuc ? 11 : 150"
                        [placeholder]="placeHolderInput" class="w-full" pInputText formControlName="termino" />
                    <div class="w-full mt-2">
                    </div>
                </div>
                <div class="field col-1">
                    <button icon="pi pi-search"
                        [disabled]="!habilitarBotonBuscar" *ngIf="esBusquedaPorRuc; else razonSocial" pButton
                        class="cfe-boton-primary btn-buscar-juridica" (click)="buscarPersonaRUC()"></button>
                    <ng-template #razonSocial>
                        <button icon="pi pi-search"
                            [disabled]="!habilitarBotonBuscar" pButton class="btn-buscar-juridica cfe-boton-primary"
                            (click)="buscarPersonaRazonSocial()"></button>
                    </ng-template>

                </div>
                <div class="field col-4">
                    <button pButton class="cfe-boton-secondary" (click)="resetForm()">Limpiar Filtros</button>
                </div>
            </div>

            @if(form.get('termino')?.value && !habilitarBotonBuscar){
                <div class="mb-2">
                    <mensaje-generico [titulo]="textoValidacion"/>   
                </div>
            }
            @if(personas.length>0){
                    <p-table class="cfe-table-primary" [value]="personasFiltrados"
                        [tableStyle]="{ 'min-width': '50rem' }">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Número de RUC</th>
                                <th>Razón Social</th>
                                <th>Acción</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-persona>
                            <tr>
                                <td>{{ persona.numeroRuc }}</td>
                                <td>{{ persona.razonSocial }}</td>
                                <td>
                                    <button class="cfe-boton-primary" pButton (click)="agregarPersona(persona)">
                                        Agregar
                                    </button>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <app-paginator
                        [query]="query"
                        [items]="itemPaginado"
                        [rowsPerPageOptions]="[]"
                        (paginate)="onPaginate($event)"
                    ></app-paginator>
            }
            @if(personas.length === 30){
                <div class="mt-2">
                    <mensaje-generico [titulo]="'Se encontraron más de 30 registros. Refine su búsqueda.'" [closable]="true"/>   
                </div>
            }
        </div>
        <button class="cfe-boton-secondary cfe-boton-m mt-5"
            (click)="cerrarModal()">Cancelar</button>
    </div>
</div>