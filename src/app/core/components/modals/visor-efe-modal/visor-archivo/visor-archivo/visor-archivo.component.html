@if (archivo != null && archivo !== '' || tipoArchivoENUM)
{
  @switch (tipoArchivo) {
    @case (tipoArchivoENUM.Ninguno) {
      <div class="text-center p-7 text-lg font-bold">
        <div class="py-7">Seleccione el archivo que desea visualizar</div>
      </div>
    }

    @case (tipoArchivoENUM.Imagen) {
      <div class="imagen">
        <img [src]="archivo" alt="Imagen Visor" />
      </div>
    }

    @case (tipoArchivoENUM.Documento) {

    <ngx-extended-pdf-viewer [src]="pdfUrl"
                             [showPresentationModeButton]="true"
                             [showDownloadButton]="true"
                             [showSecondaryToolbarButton]="false"
                             [showTextEditor]="false"
                             [showDrawEditor]="false"
                             [showUnverifiedSignatures]="true"
                             [showOpenFileButton]="false"
                             [showStampEditor]="false" />

    <!--<iframe *ngIf="pdfUrl"
              [src]="pdfUrl"
              style="width: 100%; height: 100%;"
              type="application/pdf"
              title="Pdf reader">
      </iframe>-->
    }

    @case (tipoArchivoENUM.Audio) {
      @if (archivoReproductor && archivoReproductor.fuente &&archivoReproductor.fuente != '' ) {
        <div class="player">
          <audio #playerRef
                 (loadstart)="mostrarSpinner()"
                 (canplaythrough)="eventoGenericoCargarMetadata(tipoArchivoENUM.Audio)"
                 (timeupdate)="eventoGenericoActualizarTiempo()" controls hidden>
            <source [src]="archivoReproductor.fuente" type="audio/mpeg"> Tu navegador no soporta el elemento de audio.
          </audio>

          <div class="player__controls">
            <button (click)="eventoEmisorReproducirAnterior()" [disabled]="!archivoReproductor.existeAnterior"
              class="player__button" title="Retroceder">
              <svg viewBox="0 0 24 24" fill="none" class="player__icon player__icon--skip-backward">
                <polygon points="19 3 5 12 19 21" fill="none" stroke="currentColor" stroke-width="2"></polygon>
                <line x1="3" y1="4" x2="3" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
              </svg>
            </button>

            <button (click)="eventoGenericoAlternarReproduccionPausa()" class="player__button" title="Reproducir/Pausar">
              @if (reproduciendo) {
              <svg viewBox="0 0 24 24" fill="none" class="player__icon player__icon--pause">
                <rect x="1" y="1" width="22" height="22" rx="10" ry="10" fill="none" stroke="currentColor" stroke-width="2">
                </rect>
                <rect x="8" y="6" width="3" height="12" rx="1" ry="1" fill="currentColor"></rect>
                <rect x="13" y="6" width="3" height="12" rx="1" ry="1" fill="currentColor"></rect>
              </svg>
              } @else {
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" class="player__icon player__icon--play">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              }
            </button>

            <button (click)="eventoEmisorReproducirSiguiente()" [ngClass]="{'disabled': !archivoReproductor.existeSiguiente}"
              [disabled]="!archivoReproductor.existeSiguiente" class="player__button" title="Siguiente">
              <svg viewBox="0 0 24 24" fill="none" class="player__icon player__icon--skip-forward">
                <polygon points="5 3 19 12 5 21" fill="none" stroke="currentColor" stroke-width="2"></polygon>
                <line x1="21" y1="4" x2="21" y2="20" stroke="currentColor" stroke-width="2" stroke-linecap="round"></line>
              </svg>
            </button>

            <!-- Añadimos la sección del título -->
            @let caracteresMaximos = 25;

            <div class="player__title">
              <span class="player__filename" [title]="archivoReproductor.nombre" [ngStyle]="{'max-width': '150px'}">
                {{ archivoReproductor.nombre.length > caracteresMaximos ?
                (archivoReproductor.nombre.substring(0, caracteresMaximos) + '...') : archivoReproductor.nombre }}
              </span>
            </div>

            <span class="player__time" title="Tiempo transcurrido">{{ obtenerDuracionFormato(tiempoActual) }}</span>

            <div class="player__seek-wrapper" (mousemove)="eventoGenericoMostrarTooltip($event)"
              (mouseleave)="eventoGenericoOcultarTooltip()">
              <input type="range" [(ngModel)]="valorBarra" (input)="eventoGenericoBarraDuracion()"
                [ngStyle]="{'--seek-percent': valorBarra + '%'}" step="1" min="0" max="100" title="Barra de reproducción">
              <div class="player__tooltip" [ngStyle]="{ left: posicionTooltip + 'px' }" [class.visible]="tooltipVisible">
                {{ obtenerDuracionFormato(tiempoTooltip) }}
              </div>
            </div>

            <span class="player__time" title="Duración total">{{ obtenerDuracionFormato(duracion) }}</span>

            <!-- Añade este control de volumen antes del botón de silencio -->
            <button (click)="eventoGenericoAlternarSilencio()" class="player__button" type="button" title="Control de volumen">
              @if (!silenciado) {
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" class="player__icon player__icon--volume">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>

                @if (volumen > 0.5) {
                <path d="M19.07 4.93a10 10 0 010 14.14"></path>
                <path d="M15.54 8.46a5 5 0 010 7.07"></path>
                } @else if (volumen > 0) {
                <path d="M15.54 8.46a5 5 0 010 7.07"></path>
                }
              </svg>
              } @else {
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" class="player__icon player__icon--mute">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
              }
            </button>

            <div class="player__volume-control">
              <input type="range" [(ngModel)]="volumen" (input)="eventoGenericoAjustarVolumen()"
                [ngStyle]="{'--volume-percent': volumen * 100 + '%'}" class="player__volume-slider" min="0" max="1" step="0.01"
                [title]="'Volumen al '+ volumen * 100 + '%'">
            </div>

            <!-- Ícono de Descarga -->
            @if (mostrarBotonDescargar) {
            <button (click)="eventoEmisorDescargar()" class="player__button" type="button" title="Descargar archivo">
              <img class="icono-mensaje" [src]="icon('arrow-down-to-line')" alt="Descargar" />
            </button>
            }

            <!-- Ícono de Borrado -->
            @if (mostrarBotonEliminar && !modoLectura) {
            <button (click)="eventoEmisorEliminar()" class="player__button" type="button" title="Eliminar archivo">
              <img class="icono-mensaje" [src]="icon('trash_1')" alt="Eliminar" />

            </button>
            }
          </div>
        </div>
      }
    }

    @case (tipoArchivoENUM.Video) {
      <div #fullScreenContainer class="player player--video" [ngClass]="{ 'player--video-fullscreen': pantallaCompleta }">
        <video #videoPlayerRef
               autoplay
               muted
               playsinline
               (loadstart)="mostrarSpinner()"
               (canplaythrough)="eventoGenericoCargarMetadata(tipoArchivoENUM.Video)"
               (timeupdate)="eventoGenericoActualizarTiempo()" (contextmenu)="eventoVideoMenuContextual($event)"
               (click)="eventoVideoClick(videoPlayerRef)">
          <source [src]="archivo" type="video/mp4"> Tu navegador no soporta el elemento de video.
        </video>

        <div class="player__controls" style="padding: 0.5rem 0.8rem 0.8rem;">

          <!-- Control de velocidad -->
          <label for="velocidad">Velocidad:</label>
          <select id="velocidad" (change)="eventoVideoCambiarVelocidad($event)">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x (Normal)</option>
            <option value="1.5">1.5x</option>
            <option value="2">2x</option>
          </select>

          <button class="player__button" (click)="eventoGenericoAlternarReproduccionPausa()">
            @if (!reproduciendo) {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" class="player__icon player__icon--play">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            } @else {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" class="player__icon player__icon--pause">
              <rect x="6" y="4"></rect>
              <rect x="14" y="4"></rect>
            </svg>
            }
          </button>

          <span class="player__time">
            {{ obtenerDuracionFormato(tiempoActual) }}
          </span>

          <input (input)="eventoGenericoBarraDuracion()" [(ngModel)]="valorBarra" step="1" class="player__seek-bar"
            type="range">

          <span class="player__time">
            {{ obtenerDuracionFormato(duracion) }}
          </span>

          <button (click)="eventoGenericoAlternarSilencio()" class="player__button" type="button">
            @if (!silenciado) {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" class="player__icon player__icon--volume">
              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
              <path d="M19.07 4.93a10 10 0 010 14.14"></path>
            </svg>
            } @else {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" class="player__icon player__icon--mute">
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
            }
          </button>

          <button (click)="eventoVideoMaximizarPantalla()" class="player__button" type="button">
            @if (pantallaCompleta) {
            <svg class="icon icon-fullscreen" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round" class="player__icon">
              <line x1="5" y1="5" x2="9" y2="5"></line>
              <line x1="5" y1="5" x2="5" y2="9"></line>
              <line x1="19" y1="5" x2="15" y2="5"></line>
              <line x1="19" y1="5" x2="19" y2="9"></line>
              <line x1="19" y1="19" x2="19" y2="15"></line>
              <line x1="19" y1="19" x2="15" y2="19"></line>
              <line x1="5" y1="19" x2="5" y2="15"></line>
              <line x1="5" y1="19" x2="9" y2="19"></line>
            </svg>
            } @else {
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" class="player__icon">
              <path d="M15 3h6v6"></path>
              <path d="M9 21H3v-6"></path>
              <path d="M21 15v6h-6"></path>
              <path d="M3 9V3h6"></path>
              <line x1="21" y1="3" x2="15" y2="9"></line>
              <line x1="3" y1="21" x2="9" y2="15"></line>
            </svg>
            }
          </button>
        </div>
      </div>
    }

    @default {
      <div class="text-center p-7 text-lg font-bold">
        <div class="py-7">Archivo no disponible</div>
      </div>
    }
  }
}
