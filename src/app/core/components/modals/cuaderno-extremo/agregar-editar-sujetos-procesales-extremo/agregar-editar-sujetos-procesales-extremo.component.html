<div class="registrar-nuevo-cuaderno">
  <div class="modal__header">
      <div class="modal_header__content mt-1">
          <div class="cfe-titulo-1">{{edicionDelitoSujeto ? 'Agregar sujetos':'Editar delitos'}}</div>
      </div>
      <div class="flex align-items-center justify-content-center">
          <p-button onKeyPress (click)="dialogRef.close()" icon="pi pi-times"
              styleClass="p-button-rounded text-color p-button-text"></p-button>
      </div>
  </div>
  <div class="subtitulo mb-3">
    {{edicionDelitoSujeto ? 'Seleccione los sujetos que pertenecerán a este cuaderno. Para los imputados seleccione delitos':'Seleccione los delitos o quítelos para este sujeto'}}
  </div>
  <p-table class="table-apelaciones"
           [value]="listaSujetosProcesales"
           responsiveLayout="stack"
           [paginator]="true"
           dataKey="idSujetoCaso"
           [paginator]="true"
           [rows]="10"
           [showCurrentPageReport]="true"
           [tableStyle]="{ 'min-width': '50rem' }"
           currentPageReportTemplate="{first} de {last} registros"
           [(selection)]="sujetosProcesalesSeleccionados"
           (onRowUnselect)="quitarSeleccionSujeto($event)"
           (onHeaderCheckboxToggle)="quitarSeleccionSujetoTabla($event)">

      <ng-template pTemplate="header">
          <tr>
              <th scope class="w-col-20"></th>
              <th scope>Nº</th>
              <th scope>Tipo Doc.</th>
              <th scope>Num. Doc.</th>
              <th scope>Nombres / Razón Social</th>
              <th scope>Tipo de Sujeto</th>
              <th scope>Delitos vinculados</th>
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-sujeto let-rowIndex="rowIndex">
          <tr>
              <td>
                  <p-tableCheckbox 
                              [ngClass]="{ 'bloqueado': sujeto.idSujetoCasoSeleccionado }"
                              [value]="sujeto"
                  ></p-tableCheckbox>
              </td>
              <td>{{ rowIndex + 1 }}</td>
              <td>{{ sujeto.tipoDocumento }}</td>
              <td>{{ sujeto.nuDocumento }}</td>
              <td>{{ sujeto.sujeto }}</td>
              <td>{{ sujeto.noTipoParteSujeto }}</td>
              <td style="width: 500px;">
                  <p-multiSelect [disabled]="!sujetoSeleccionado(sujeto.idSujetoCaso)" 
                                 #multiSelect
                                 appendTo="body"
                                 styleClass="py-1 p-inputtext-lg w-full"
                                 [options]="sujeto.delitos"
                                 placeholder="Seleccione Delito"
                                 filterPlaceholder="Seleccione el(los) delito(s)"
                                 optionLabel="delitoCompleto" display="chip"
                                 emptyFilterMessage="No se encontraron resultados"
                                 emptyMessage="No se encontraron resultados"
                                 [(ngModel)]="sujeto.delitosSeleccionados"
                                 [showToggleAll]="false"
                                 [maxSelectedLabels]="sujeto.delitos?.length"
                                 (onChange)="seleccionarDelito(sujeto, $event)">
                                 <ng-template pTemplate="selectedItems" let-items>
                                  <div class="custom-delitos-items">
                                    <ng-container>
                                      @if (items?.length > 0) {
                                        @for (item of items;track $index) {
                                          <span
                                            [pTooltip]="mostrarcTooltipDelito(item)"
                                            tooltipStyleClass="tooltip-cuadernos-extremos"
                                            tooltipEvent="hover"
                                            [escape]="false"
                                            class="delito-item"
                                            [ngClass]="{'existe-extremo': item.existeExtremo}">
                                            {{ item.delitoCompleto }}
                                            <i
                                              class="pi pi-times"
                                              onKeyPress
                                              (click)="quitarDelito(sujeto, item, $event, multiSelect)">
                                            </i>
                                          </span>
                                        }
                                      } @else {
                                        <span class="no-seleccionado">Seleccione delitos</span>
                                      }
                                    </ng-container>
            
                                  </div>
                                </ng-template>
                  </p-multiSelect>
                  <div class="text-right mt-2"><span onKeyPress class="tipificar-nuevo-delitos" (click)="tipificarNuevosDelitos(sujeto.idSujetoCaso)">Tipificar nuevos delitos</span></div>
              </td>
          </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
          <tr>
              <td colspan="7">
                  <div class="text-center">No se han encontrado sujetos procesales</div>
              </td>
          </tr>
      </ng-template>
  </p-table>
  <div class="flex justify-content-between align-items-center gap-3 mt-4">
      <button (click)="cerrarVentana()"
              type="button" class="cfe-boton-secondary cfe-boton-lg inline w-full md:w-auto family-poppin-bold">Cancelar</button>
      <button [disabled]="!validarSeleccionSujetos()" (click)="confirmarCrearCuaderno()" type="button"
           class="cfe-boton-primary cfe-boton-lg inline ml-0 md:ml-2 mt-1 md:mt-0 md:w-auto family-poppin-bold">
          {{edicionDelitoSujeto ? 'Agregar sujetos':'Actualizar sujeto'}}
        </button>
  </div>

</div>
