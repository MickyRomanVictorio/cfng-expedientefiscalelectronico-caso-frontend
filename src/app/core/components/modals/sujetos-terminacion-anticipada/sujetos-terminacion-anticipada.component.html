<div class="sujetos_terminacion__anticipada">
  <div class="modal__header">
    <div class="modal_header__content mt-1">
      <div class="cfe-titulo-1">Seleccionar los sujetos procesales</div>
    </div>
    <div class="flex align-items-center justify-content-center">
      <p-button onKeyPress (click)="dialogRef.close()" icon="pi pi-times"
        styleClass="p-button-rounded text-color p-button-text"></p-button>
    </div>
  </div>
  <div class="titulo-numero-caso mb-3">
    Incidente:
    <span [innerHTML]="stringUtil.obtenerNumeroCaso(numeroCaso)"></span>
  </div>
  @if(mostrarAlertaSujeto && !modoLectura){
    <div class="flex-center border-round-lg px-3 py-2 gap-2 mb-3 label-bg-warning">
      <fn-icon class="label-info-secondary"
              [ico]="iconUtil.obtenerIcono('iInfoCircle')" height="1.5rem" />

      <span class="text-md">
        Si desea seleccionar sujetos procesales, que no se encuentran listados;
        estos podrán ser agregados desde la pestaña “Sujetos procesales” del cuaderno incidental.
        <a class="cfe-enlace-general"
          routerLink="{{ obtenerUrlSujetos() }}"
          (click)="dialogRef.close()">
          Ir a sujetos procesales</a>
      </span>
      <div class="ml-auto">
        <fn-icon
            class="cursor-pointer"
            [ico]="iconUtil.obtenerIcono('iClose')"
            (click)="mostrarAlertaSujeto = false"
            height="1.5rem"
            onkeydown=""
        />
      </div>

    </div>
  }    
  <div class="subtitulo mb-3 font-bold">
      {{mensajesPorTramite.superior}}
  </div>
  
  <p-table  class="cfe-table-primary sujeto_procesal_table"
            [value]="listaSujetosProcesales"
            [paginator]="true"
            [(selection)]="sujetosProcesalesSeleccionados"
            [rows]="10"
            [showCurrentPageReport]="true"
            [tableStyle]="{ 'min-width': '50rem' }"
            dataKey="idSujetoCaso"
            currentPageReportTemplate="{first} de {last} registros"
       >
        <ng-template pTemplate="header">
            <tr>
                <th scope class="w-col-20">
                    <p-tableHeaderCheckbox [disabled]="modoLectura"></p-tableHeaderCheckbox>
                </th>
                <th scope>Nº</th>
                <th scope>Nombres y apellidos/Razón social.</th>
                <th scope>Tipo de sujeto procesal</th>
                <th scope>Delito(s)</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-sujeto let-rowIndex="rowIndex">
            <tr>
                <td>
                    <p-tableCheckbox [disabled]="modoLectura" [value]="sujeto"></p-tableCheckbox>
                </td>
                <td>{{ rowIndex + 1 }}</td>
                <td>{{ sujeto.nombreSujeto }}</td>
                <td>{{ sujeto.noTipoParteSujeto }}</td>
                <td>
                  @if(sujeto.delitos.length>0){
                    @for (delito of sujeto.delitos; track delito.id) {
                      <span class="delitos-item">{{ mostrarDelitos(delito) }}</span>
                    }
                  }
                  @else{
                    <span class="delitos-item">No se han tipificado delitos</span>
                  }
                </td>

            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7">
                    <div class="text-center">No se han encontrado sujetos procesales</div>
                </td>
            </tr>
        </ng-template>
    </p-table>

  @if(sujetosProcesalesSeleccionados.length > 0){
    <div class="flex-center border-round-lg px-4 py-3 gap-2 mt-3 mb-3 label-bg-warning">
      <span class="text-md">
        {{mensajesPorTramite.inferior}}
      </span>
    </div>
  }
  <div class="flex justify-content-center align-items-center gap-3 mt-4">
    <button (click)="dialogRef.close()"
            type="button"
      class="cfe-boton-secondary cfe-boton-lg inline w-full md:w-auto family-poppin-bold">{{modoLectura?'Cerrar':'Cancelar'}}</button>
    @if(!modoLectura){
      <button type="button"
      [disabled]="sujetosProcesalesSeleccionados.length == 0"
      (click)="guardarSujetos()"
      class="cfe-boton-primary cfe-boton-lg inline ml-0 md:ml-2 mt-1 md:mt-0 md:w-auto family-poppin-bold">Aceptar</button>
    }
  </div>

</div>
