<div class="cfe-container">
  <div class="derivado__table">
    <div class="derivado_table__title grid nested-grid">
      <div class="derivado_table_title__content col-6 flex">
        <fn-icon
          [ico]="icono('iFolderExclamation')"
          height="1.8rem"
          [style]="{ 'margin-left': '-12px' }"
        ></fn-icon>
        <h4 class="cfe-subtitulo-1 ml-1">
          Lista de casos que me han derivado y he aceptado
        </h4>
      </div>
      <div
        class="col-12 md:col-6 flex flex-column sm:flex-row justify-content-end align-items-center pr-0"
      >
        <button
          class="cfe-boton-secondary cfe-boton-m cfe-boton-icono-izquierda w-full sm:w-auto mr-0 sm:mr-3 mb-2 sm:mb-0 justify-content-start"
          (click)="exportar('PDF')"
        >
          <fn-icon
            class="ml-1"
            [ico]="icono('iFileDownload')"
            height="1.6rem"
          ></fn-icon>
          Exportar PDF
        </button>
        <button
          class="cfe-boton-secondary cfe-boton-m cfe-boton-icono-izquierda w-full sm:w-auto justify-content-start"
          (click)="exportar('Excel')"
        >
          <fn-icon
            class="ml-1"
            [ico]="icono('iTable')"
            height="1.6rem"
          ></fn-icon>
          Exportar Excel
        </button>
        <div class="grid">
          <div class="col-12 sm:col-12 md:col-12 lg:col-6"></div>
          <div class="col-12 sm:col-12 md:col-12 lg:col-6"></div>
        </div>
      </div>
    </div>
    <div class="derivado_table__content">
      <p-table
        [value]="enviadosAceptadosTemp"
        [rowHover]="true"
        [tableStyle]="{ 'min-width': '50rem' }"
        [styleClass]="'p-datatable-sm'"
        [breakpoint]="'992px'"
        responsiveLayout="stack "
      >
        <ng-template pTemplate="header">
          <tr>
            <th>N°</th>
            <th class="w-15rem" pSortableColumn="codigoCaso">
              Número de caso <p-sortIcon field="codigoCaso"></p-sortIcon>
            </th>
            <th pSortableColumn="remitentedenuncia">
              Remitente <p-sortIcon field="remitentedenuncia"></p-sortIcon>
            </th>
            <th pSortableColumn="origen">
              Origen <p-sortIcon field="origen"></p-sortIcon>
            </th>
            <th class="w-10rem" pSortableColumn="fechaResultado">
              Fecha derivación <p-sortIcon field="fechaResultado"></p-sortIcon>
            </th>
            <th class="w-10rem" pSortableColumn="fechaDevolucion">
              Fecha aceptacion <p-sortIcon field="fechaDevolucion"></p-sortIcon>
            </th>
            <th class="w-8rem">Ir al caso</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-aceptado let-rowIndex="rowIndex">
          <tr class="">
            <td class="table_td_content_start caso-container">
              {{ indexPag(rowIndex) }}
            </td> 
            <td data-column-name="Número de caso">
              <div>
                <view-numero-caso [numeroCaso]="aceptado.numeroCaso" />
                <div *ngIf="aceptado.tipoDerivacion === '1'" class="mb-1">
                  <div class="mt-3">
                    <button class="btn-derivacion">Derivación directa</button>
                  </div>
                </div>
              </div>
            </td>
            <td data-column-name="Remitente">
              <div>
                {{
                  aceptado.remitenteDenuncia
                    ? "Fiscal: " + aceptado.remitenteDenuncia.trim()
                    : ""
                }}
              </div>
            </td>
            <td data-column-name="Origen">
              <span>
                {{ aceptado.destino | capitalizar }}
              </span>
            </td>
            <td data-column-name="Fecha derivación">
              <div *ngIf="aceptado.fechaDerivacion">
                <div>
                  {{ aceptado.fechaDerivacion | dateformat }}
                </div>
                <div>
                  {{ aceptado.horaDerivacion | dateformat : "hour" }}
                </div>
              </div>
              <div *ngIf="!aceptado.fechaDerivacion">-</div>
            </td>
            <td data-column-name="Fecha aceptacion">
              <div *ngIf="aceptado.fechaAceptacion">
                <div>
                  {{ aceptado.fechaAceptacion | dateformat }}
                </div>
                <div>
                  {{ aceptado.horaAceptacion | dateformat : "hour" }}
                </div>
              </div>
              <div *ngIf="!aceptado.fechaAceptacion">-</div>
            </td>
            <td data-column-name="Ir al caso">
              <div>
                <div class="col-4 btn-accion mr-1 ml-5 mb-1">
                  <p-button
                    class="btn-caso"
                    (click)="abrirDetalleCaso(aceptado)"
                  >
                    <fn-icon [ico]="icono('iChevronRight')"></fn-icon>
                  </p-button>
                </div>
                <div class="yellow-box">
                  <label *ngIf="aceptado.flgDerivado == '1' && aceptado.flgAsignado == '1' && aceptado.flgRecepcion == '1'" >
                    Asignado a {{ aceptado.fiscalAsignado }}
                  </label>
                  <label *ngIf="aceptado.flgDerivado == '1' && aceptado.flgAsignado == '0' && aceptado.flgRecepcion == '0'">
                    Pendiente de asignar
                  </label>
                  <label *ngIf="aceptado.flgDerivado == '1' && aceptado.flgAsignado == '1' && aceptado.flgRecepcion == '0'">
                    Pendiente de recibir por {{ aceptado.fiscalAsignado }}
                  </label>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td class="no-before text-center" colspan="9">
              No se encontraron registros con los criterios de búsqueda
              aceptados
            </td>
          </tr>
        </ng-template>
      </p-table>
      <app-paginator
        [query]="query"
        [items]="itemPaginado"
        [rowsPerPageOptions]="[]"
        [resetPage]="resetPage"
        (paginate)="onPaginate($event)"
      ></app-paginator>
    </div>
  </div>
</div>

<p-toast></p-toast>
