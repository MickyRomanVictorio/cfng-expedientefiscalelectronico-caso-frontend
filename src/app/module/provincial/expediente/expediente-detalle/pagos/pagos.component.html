
@if(tabs.length>0){
    <h3 class="cfe-titulo-2">Seguimiento de pagos</h3>
    <div class="mt-4">
        <tabs-view-pagos [tabs]="tabs" (onChangeIndex)="cambiarTab($event)" />
        @if(reparacionSeleccionada && tabsSeleccionado && tabs.length>0){
        <p-tabView>
            <div class="barra-superior" [class.atrasado]="tabsSeleccionado.atrasado"></div>
            <div class="reparacion-civil">
                <div class="contenido">
                    <div class="columna primero">
                        <div><strong>Código:</strong>
                            <span>{{reparacionSeleccionada.codReparacionCivil}}</span>
                        </div>
                        <div class="mt-3">
                            <strong>Tipo:</strong>
                            <span>{{ capitalizedFirstWord(reparacionSeleccionada.tipo)}}</span>
                        </div>
                        @if(reparacionSeleccionada.salidaAlterna){
                            <div class="mt-3">
                                <strong>Salida alterna:</strong>
                                <span>{{ capitalizedFirstWord(reparacionSeleccionada.salidaAlterna)}}</span>
                            </div>
                        }
                    </div>
                    <div class="columna">
                        <strong>Deudores:</strong>
                        @for (deudor of reparacionSeleccionada.listaDeudores.slice(0, 2); track $index) {
                        <p>{{ deudor }}</p>
                        }
                        <span onKeyPress (click)="abrirModalSujetos(REPARACION_CIVIL.DEUDOR)" class="todos">Ver detalle</span>
                    </div>
    
                    <div class="columna">
                        <strong>Agraviados:</strong>
                        @for (acreedor of reparacionSeleccionada.listaAcreedores.slice(0, 2); track $index) {
                        <p>{{ acreedor }}</p>
                        }
                        <span onKeyPress (click)="abrirModalSujetos(REPARACION_CIVIL.ACREEDOR)" class="todos">Ver detalle</span>
                    </div>
    
                    <div class="columna montos">
                        <div>
                            <strong>Monto pagado:</strong>
                            <span>{{reparacionSeleccionada.montoPagado | solPeruano }}</span>
                        </div>
                        <div>
                            <strong>Monto pendiente:</strong>
                            <span>{{reparacionSeleccionada.montoPendiente | solPeruano}}</span>
                        </div>
                        <div>
                            <strong>Deuda total:</strong>
                            <span class="total">{{reparacionSeleccionada.deudaTotal | solPeruano }}</span>
                        </div>
                        <div><strong>Cuotas pagadas:</strong>
                            <span>{{reparacionSeleccionada.cuotasPagadas}} /{{reparacionSeleccionada.cuotasTotales}}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pl-4 pr-4 pt-2">
                <div class="flex flex-wrap flex-column sm:flex-row px-0 mt-1 pb-4">
                    @for (filtro of filtroBandeja; track $index) {
                    <p-button onKeyPress [label]="filtro.descripcion" (click)="filtrarListaCuotas(filtro.codigo)"
                        styleClass="cfe-boton-outline cfe-boton-secondary p-button-rounded p-button-sm mt-2 mr-2 w-auto font-normal text-left {{filtro.codigo === filtrosTramiteSelec ? 'active' : ''}}">
                        @if (filtro.color!=='') {
                        <i class="pi pi-circle-fill mr-2" [style.color]="filtro.color"></i>
                        }
                    </p-button>
                    }
                </div>
                <p-table [value]="reparacionSeleccionada.cuotas"
                         responsiveLayout="stack"
                         [paginator]="true"
                         dataKey="idCuotas"
                         [paginator]="true"
                         [rows]="10"
                         [showCurrentPageReport]="true"
                         [tableStyle]="{ 'min-width': '50rem' }"
                         currentPageReportTemplate="{first} de {last} registros">
                    <ng-template pTemplate="header">
                        <tr>
                            <th scope>Número de cuota</th>
                            <th class="text-left" scope>Fecha de vencimiento</th>
                            <th class="text-right" scope>Monto pagado</th>
                            <th class="text-right" scope>Monto pendiente</th>
                            <th class="text-right" scope>Monto de cuota</th>
                            <th class="text-left" scope>Estado</th>
                            <th scope>Opciones</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-cuota let-rowIndex="rowIndex">
                        <tr>
                            <td>
                                <div class="flex">
                                    <div class="leyenda-pago mr-2">
                                        <div class="legend-item">
                                            <span class="legend-circle"
                                                [class.pendiente]="cuota.idEstadoCuota === CUOTAS.PENDIENTE"
                                                [class.atrasado]="cuota.idEstadoCuota === CUOTAS.ATRASADO"
                                                [class.pagado]="cuota.idEstadoCuota === CUOTAS.PAGADO">
                                            </span>
                                        </div>
                                    </div>
                                    <span>Cuota {{ cuota.cuota }}</span>
                                </div>
                            </td>
                            <td class="text-left">
                                {{ cuota.fechaVencimiento }}
                            </td>
                            <td class="text-right">
                                {{ cuota.montoPagado | solPeruano }}
                            </td>
                            <td class="text-right">
                                {{ cuota.montoPendiente | solPeruano }}
                            </td>
                            <td class="text-right">
                                {{ cuota.montoCuota | solPeruano }}
                            </td>
                            <td class="text-left">
                                {{ capitalizedFirstWord(cuota.estado) }}
                            </td>
                            <td>
                                <button [disabled]="!cuota.activarPago" 
                                        (click)="abrirModalRegistrarEditarPagos(cuota)"
                                        type="button" 
                                        class="cfe-boton-secondary cfe-boton-sm"
                                        style="font-size: 16px;">
                                    <img [src]="monedaSol" 
                                        height="23" 
                                        alt="sol" 
                                        class="mr-1" />
                                        Pagos
                                </button>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7">
                                <div class="text-center">No se han encontrado cuotas</div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-tabView>
        }
        @else{
            <div class="mt-4 w-full text-xl font-semibold text-primary mb-1 family-poppin-bold text-center">No se han encontrado información de la reparación civil</div>
        }
    </div>    
}
@else{
    <div class="mt-4 w-full text-xl font-semibold text-primary mb-1 family-poppin-bold text-center">En estos momentos no hay pagos registrados</div>
}