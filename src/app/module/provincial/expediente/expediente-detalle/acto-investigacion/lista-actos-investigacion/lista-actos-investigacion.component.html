<app-filtro-acto-investigacion
  (buscarOut)="eventoBuscar($event)"
  (buscarTextOut)="eventoBuscarText($event)"
></app-filtro-acto-investigacion>

<p-table
  [value]="listaActosInvestigacion"
  [styleClass]="'p-datatable-sm'"
  responsiveLayout="stack"
>
  <ng-template pTemplate="header">
    <tr>

      @if(tipoAccionActual===tipoAccionEnum.VISUALIZAR){
      <th class="w-4rem">
        <p-checkbox
          [(ngModel)]="seleccionadoTodo"
          binary="true"
          (onChange)="toggleAllActosProcesales($event.checked)"
        />
      </th>
      }
      <th>N°.</th>
      <th>Acto investigación</th>
      <th>Origen</th>
      <th>Fecha ingreso</th>
      <th>Acciones</th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-actoProcesal let-rowIndex="rowIndex">
    <tr
      [ngStyle]="{
        background:
          actoProcesal.respuestas.length > 0
            ? 'rgba(247, 238, 212, 0.45)'
            : 'initial'
      }"
    >

      @if(tipoAccionActual===tipoAccionEnum.VISUALIZAR){
      <td>
        <p-checkbox
          [(ngModel)]="actoProcesal.seleccionado"
          binary="true"
          (onChange)="toggleActoProcesalSelection(actoProcesal, $event.checked)"
        />
      </td>
      }
      <td>
        <span class="p-column-title font-bold">N°: </span> {{ rowIndex + 1 }}.
      </td>
      <td>
        <span class="p-column-title font-bold">Acto investigación: </span
        >{{ actoProcesal.descripcion }}
      </td>
      <td>
        <span class="p-column-title font-bold">Origen: </span>
        <div>
          <p class="m-0">
            <span class="font-bold m-0">Acto Procesal: </span><br />{{
              actoProcesal.actoProcesal
            }}
          </p>
          <p class="m-0">
            <span class="p-column-title font-bold">Trámite:</span>
            {{ actoProcesal.tramite }}
          </p>
          <p class="m-0">
            <span class="p-column-title font-bold">Fecha:</span>
            {{ actoProcesal.fechaOrigen }}
          </p>
        </div>
      </td>
      <td>
        <span class="p-column-title font-bold">Fecha ingreso: </span
        >{{ actoProcesal.fechaIngreso }}
      </td>
      <td>
        <span class="p-column-title font-bold">Acciones: </span>
      </td>
      <td>
        @if (actoProcesal.respuestas.length > 0) {
        <i
          class="cursor-pointer pi pi-chevron-down"
          [ngClass]="{'rotate-180': actoProcesal.expanded}"
          (click)="eventoExpandirFila(actoProcesal)"
        ></i>
        }
      </td>
    </tr>
    @if (actoProcesal.respuestas.length > 0 && actoProcesal.expanded) {
    <tr>
      <td colspan="7" class="m-0 p-0">
        <p-table
          [value]="actoProcesal.respuestas"
          responsiveLayout="stack"
          class="p-datatable-sm m-0 p-0 w-full"
        >
          <ng-template pTemplate="header">
            <tr style="background: rgba(229, 221, 196, 1)">

              @if(tipoAccionActual===tipoAccionEnum.VISUALIZAR){
              <th>
              </th>
              }
              <th></th>
              <th>Respuesta</th>
              <th>Elementos de convicción</th>
              <th>Clasificación</th>
              <th>Fecha Ingreso</th>
              <th class="w-4">Sujetos procesales</th>
              <th>Acciones</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-respuesta let-rowIndex2="rowIndex">
            <tr style="background: rgba(218, 205, 170, 0.45)">

              @if(tipoAccionActual===tipoAccionEnum.VISUALIZAR){
              <td>
                <p-checkbox
                  [binary]="true"
                  [(ngModel)]="respuesta.seleccionado"
                  (onChange)="toggleRespuestaSelection(actoProcesal)"
                />
              </td>
              }
              <td>
                <span class="p-column-title font-bold">N°: </span
                >{{ rowIndex + 1 }}.{{ rowIndex2 + 1 }}
              </td>
              <td>
                <span class="p-column-title font-bold">Respuesta: </span
                >{{ respuesta.respuesta }}
              </td>
              <td>
                <span class="p-column-title font-bold"
                  >Elementos de convicción: </span
                >({{ respuesta.elementos }})
              </td>
              <td>
                <span class="p-column-title font-bold">Clasificación: </span>
                <div
                  class="badge badge-actos-investigacion-{{
                    obtenerClaseTipoEvidencia(respuesta.clasificacion)
                  }} w-8"
                >
                  {{ respuesta.clasificacion }}
                </div>
              </td>
              <td>
                <span class="p-column-title font-bold">Fecha ingreso: </span>
                {{ respuesta.fechaIngreso }}
              </td>
              <td>
                <span class="p-column-title font-bold"
                  >Sujetos procesales:</span
                >
                <div class="flex flex-column p-0 m-0">
                  {{sujetosProcesales(respuesta)}}
                  @if(superaLimiteDeCaracteres(respuesta.sujetos)){
                  <span class="p-0 m-0 cursor-pointer underline text-blue-600 w-max" (click)="alternarVista(respuesta)">{{respuesta.isCollapsed ? 'Ver más' : 'Ver menos'}}</span>
                  }
                </div>
              </td>
              <td>
                <span class="p-column-title font-bold">Acciones:</span>
                <div class="flex gap-2">
                  <p-button
                    icon="pi pi-eye"
                    class="p-button-rounded p-button-info"
                    (click)="eventoVisualizar(respuesta)"
                  ></p-button>
                  @if(tipoAccionActual===tipoAccionEnum.EDITAR) {
                  <p-button
                    icon="pi pi-pencil"
                    class="p-button-rounded p-button-info"
                    (click)="eventoEditarActoInvestigacion(respuesta)"
                  ></p-button>
                  }
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </td>
    </tr>
    }
  </ng-template>
</p-table>
<app-paginator
  [query]="query"
  [items]="itemPaginado"
  [rowsPerPageOptions]="[]"
  (paginate)="onPaginate($event)"
></app-paginator>

@if(tipoAccionActual===tipoAccionEnum.VISUALIZAR){
<div class="col-12 margin-top-button">
  <div class="flex justify-content-between mt-3">
    <p-button
      label="Cancelar"
      styleClass="p-button cfe-boton-secondary text-primary font-bold px-4 py-1.2"
    >
    </p-button>
    <p-button
      [disabled]="!isAnySeleccionado"
      label="Confirmar selección"
      styleClass="p-button cfe-boton-primary text-white font-semibold  px-4  py-1.2"
      (onClick)="eventoConfirmarSeleccion()"
    >
    </p-button>
  </div>
</div>
}
