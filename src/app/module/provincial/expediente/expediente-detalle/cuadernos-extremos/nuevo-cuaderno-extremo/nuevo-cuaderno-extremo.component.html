<div class="registrar-nuevo-cuaderno">
    <div class="modal__header">
        <div class="modal_header__content mt-1">
            <div class="cfe-titulo-1">Crear cuaderno</div>
        </div>
        <div class="flex align-items-center justify-content-center">
            <p-button onKeyPress (click)="dialogRef.close()" icon="pi pi-times"
                styleClass="p-button-rounded text-color p-button-text"></p-button>
        </div>
    </div>
    <div class="subtitulo mb-3">
        Seleccione los sujetos que pertenecerán a este cuaderno. Y seleccione sus delitos vinculados
    </div>


    <p-table class="table-cuadernos" [value]="listaSujetosProcesales" responsiveLayout="stack" [paginator]="true"
        dataKey="idSujetoCaso" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
        [tableStyle]="{ 'min-width': '50rem' }" currentPageReportTemplate="{first} de {last} registros"
        [(selection)]="sujetosProcesalesSeleccionados" (onRowUnselect)="quitarSeleccionSujeto($event)" (onHeaderCheckboxToggle)="quitarSeleccionSujetoTabla($event)">
        <ng-template pTemplate="header">
            <tr>
                <th class="w-col-20">
                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <th>Nº</th>
                <th>Tipo Doc.</th>
                <th>Num. Doc.</th>
                <th>Nombres / Razón Social</th>
                <th>Tipo de Sujeto</th>
                <th>Delitos vinculados</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-sujeto let-rowIndex="rowIndex">
            <tr>
                <td>
                    <p-tableCheckbox [value]="sujeto"></p-tableCheckbox>
                </td>
                <td>{{ rowIndex + 1 }}</td>
                <td>{{ sujeto.tipoDocumento }}</td>
                <td>{{ sujeto.nuDocumento }}</td>
                <td>{{ sujeto.sujeto }}</td>
                <td>{{ sujeto.noTipoParteSujeto }}</td>
                <td style="width: 500px;">
                    <p-multiSelect [disabled]="!sujetoSeleccionado(sujeto.idSujetoCaso)" #multiSelect appendTo="body" styleClass="py-1 p-inputtext-lg w-full"
                        [options]="sujeto.delitos" placeholder="Seleccione Delito"
                        filterPlaceholder="Seleccione el(los) delito(s)" optionLabel="delitoCompleto" display="chip"
                        emptyFilterMessage="No se encontraron resultados" emptyMessage="No se encontraron resultados"
                        [(ngModel)]="sujeto.delitosSeleccionados" [showToggleAll]="false"
                        [maxSelectedLabels]="sujeto.delitos?.length" (onChange)="seleccionarDelito(sujeto, $event)">
                        <ng-template pTemplate="selectedItems" let-items>
                            <div class="custom-delitos-items">
                                <ng-container *ngIf="items?.length; else noItems">
                                    <span [pTooltip]="mostrarcTooltipDelito(item)" tooltipStyleClass="tooltip-cuadernos-extremos" tooltipEvent="hover" [escape]="false" *ngFor="let item of items"
                                        class="delito-item" [ngClass]="item.existeExtremo ? 'existe-extremo' : ''">
                                        {{ item.delitoCompleto }}
                                        <i class="pi pi-times"
                                            (click)="quitarDelito(sujeto, item, $event, multiSelect)"></i>
                                    </span>
                                </ng-container>
                                <ng-template #noItems>
                                    <span class="no-seleccionado">Seleccione delitos</span>
                                </ng-template>
                            </div>
                        </ng-template>
                    </p-multiSelect>
                    <div class="text-right mt-2"><span class="tipificar-nuevo-delitos" (click)="tipificarNuevosDelitos(sujeto.idSujetoCaso)">Tipificar nuevos delitos</span></div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7">
                    <div class="text-center">No se han encontrado sujetos procesales</div>
                </td>
            </tr>
        </ng-template>
    </p-table>
    <div class="flex justify-content-between align-items-center gap-3 mt-4">
        <button (click)="cerrarVentana()" type="button" class="cfe-boton-secondary cfe-boton-lg inline w-full md:w-auto family-poppin-bold">Cancelar</button>
        <button [disabled]="!validarSeleccionSujetos()" (click)="confirmarCrearCuaderno()" type="button"
             class="cfe-boton-primary cfe-boton-lg inline ml-0 md:ml-2 mt-1 md:mt-0 md:w-auto family-poppin-bold">Crear
            Cuaderno</button>
    </div>

</div>
