<div class="cfe-container">

    <div class="elevacion_actuados__header">
        <div class="casos_por_asignar_header__content">
            <fn-icon [ico]="icono('iFolderSearch')" height="1.6rem"></fn-icon>
            <h3 class="cfe-titulo-1">Bandeja de casos de elevación de actuados</h3>
            <fn-icon [ico]="icono('iTooltip')" height="1.6rem"></fn-icon>
        </div>
        <div class="casos_por_asignar_header__navigate">
            <button class="cfe-boton-secondary cfe-boton-sm" routerLink="../listar-casos-anulados">
                Ver casos observados
                <fn-icon [ico]="icono('iChevronRight')" height="1.5rem"></fn-icon>
            </button>
        </div>
    </div>

    <form class="casos_por_asignar__filters" [formGroup]="formularioFiltrarCasos">
        <div class="grid mt-1">
            <div class="col">
                <div class="field mb-0">
                    <label for="buscar" class="font-semibold">Buscar</label>
                    <input (input)="onInput(input.value)" #input pInputText type="text"
                        class="p-inputtext-lg py-3 text-lg w-full"
                        placeholder="Ingrese algún texto para buscar, por ejemplo el número de caso, nombre de las partes, etc"
                        formControlName="buscar" />
                </div>
            </div>
            <div class="col-fixed" style="width: 70px;" [ngClass]="{'cfe-filtro-boton-fondo': mostrarFiltros}">
                <div class="field mb-0">
                    <label for="button" class="font-semibold">&nbsp;</label>
                    <button class="cfe-filtro-boton" (click)="eventoMostrarOcultarFiltros()">
                        <fn-icon [ico]="icono('iFilterShow')" height="2.1rem"></fn-icon>
                    </button>
                </div>
            </div>
        </div>
        <div class="grid mt-3 mb-4" *ngIf="!mostrarFiltros">
            <div class="col">
                <div class="flex flex-wrap gap-3">
                    <div class="flex align-items-center">
                        <p-radioButton value="ultimosMeses" formControlName="tiempoAFiltrar"
                            inputId="ultimoSeisMeses"></p-radioButton>
                        <label for="para filtrar los últimos 6 meses" class="ml-2">Últimos 6 meses</label>
                    </div>
                    <div class="flex align-items-center">
                        <p-radioButton value="todos" formControlName="tiempoAFiltrar"
                            inputId="todosLosMeses"></p-radioButton>
                        <label for="para filtrar todos los meses" class="ml-2">Todos los meses</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid mt-1 cfe-filtros" *ngIf="mostrarFiltros">
            <div class="cfe-filtros-fondo">
                <div class="col">
                    <div class="field mb-0">
                        <label for="Fecha de asignacion" class="font-semibold">
                            Fiscalia
                        </label>
                        <div class="grid">
                            <div class="col">
                                <p-dropdown (onChange)="changePlazos($event)" styleClass="p-inputtext-lg py-1"
                                    [options]="plazos" optionValue="id" optionLabel="nombre"
                                    emptyMessage="Sin resultados" placeholder="Todos" [showClear]="true"
                                    formControlName="plazo"></p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="field mb-0">
                        <label for="plazos" class="font-semibold">Despacho</label>
                        <div class="grid">
                            <div class="col">
                                <p-dropdown (onChange)="changePlazos($event)" styleClass="p-inputtext-lg py-1"
                                    [options]="plazos" optionValue="id" optionLabel="nombre"
                                    emptyMessage="Sin resultados" placeholder="Todos" [showClear]="true"
                                    formControlName="plazo"></p-dropdown>
                            </div>
                            <div class="col origin-container">
                                <label for="extras" class="font-semibold adjust-origin-label">Remitente</label>
                                <input (input)="onInput(input.value)" #input pInputText type="text"
                                class="p-inputtext-lg py-3 text-lg w-full"
                                placeholder=""
                                formControlName="buscar" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Fila abajo -->
            <div class="cfe-filtros-fondo">
                <div class="col">
                    <div class="field mb-0">
                        <label for="Fecha de asignacion" class="font-semibold">
                            Fecha de elevación al despacho(búsqueda por periodo):
                        </label>
                        <div class="grid">
                            <div class="col">
                                <p-calendar (onSelect)="seleccionarFechaInicio($event)" dateMask dateFormat="dd/mm/yy"
                                    class="p-inputtext-lg cfe-calendar h-56" [showIcon]="true" icon="cfe-calendar-icon"
                                    placeholder="dd/mm/aaaa" formControlName="fechaDesde"></p-calendar>
                            </div>
                            <div class="col">
                                <p-calendar (onSelect)="seleccionarFechaFin($event)" dateMask dateFormat="dd/mm/yy"
                                    class="p-inputtext-lg cfe-calendar h-56" [showIcon]="true" icon="cfe-calendar-icon"
                                    placeholder="dd/mm/aaaa" formControlName="fechaHasta"></p-calendar>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="field mb-0">
                        <label for="plazos" class="font-semibold">Origen</label>
                        <div class="grid">
                             
                            <div class="col origin-container">
                                <p-dropdown (onChange)="changeOrigen($event)" styleClass="p-inputtext-lg py-1"
                                    [options]="origen" optionValue="id" optionLabel="nombre" placeholder="Todos"
                                    emptyMessage="Sin resultados" [showClear]="true"
                                    formControlName="origen"></p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cfe-filtros-fondo cfe-filtros-opciones">
                <button class="cfe-boton-secondary cfe-boton-m mr-3 boton-w" (click)="limpiarFiltros()">Limpiar
                    filtros</button>
                <button class="cfe-boton-primary cfe-boton-m mr-2 boton-w"
                    (click)="obtenerCasosPorAsignarGrilla()">Buscar</button>
            </div>
        </div>

    </form>

    <div class="casos_por_asignar__table">
        <div class="casos_por_asignar_table__title">
            <div class="casos_por_asignar_table_title__content">
                <fn-icon [ico]="icono('iFolderExclamation')" height="1.8rem"
                    [style]="{'margin-left': '-12px'}"></fn-icon>
                <h4 class="cfe-subtitulo-1">{{ casosPorAsignar.length }} Casos por asignar</h4>
            </div>
            <div class="casos_por_asignar_table_title__options">
                <button class="cfe-boton-secondary cfe-boton-m mr-3 cfe-boton-icono-izquierda"
                    (click)="exportarPdfExcel('PDF')">
                    <fn-icon class="ml-1" [ico]="icono('iFileDownload')" height="1.6rem"></fn-icon>
                    Exportar PDF
                </button>
                <button class="cfe-boton-secondary cfe-boton-m cfe-boton-icono-izquierda"
                    (click)="exportarPdfExcel('Excel')">
                    <fn-icon class="ml-1" [ico]="icono('iTable')" height="1.6rem"></fn-icon>
                    Exportar Excel
                </button>
            </div>
        </div>
        <div class="casos_por_asignar__legend">
            <div *ngFor="let item of leyenda; index as i" class="term-item">
                <span class="{{ obtenerClaseDeOrigen(i+1) }}"></span> {{ item.nombrePlazo }}
                <div class="quantity">({{ item.cantidad }})</div>
            </div>
        </div>
        <div class="casos_por_asignar_table__content">
            <p-table [value]="casosPorAsignarFiltrados" [paginator]="true" [rowHover]="true" [rows]="10"
                [showCurrentPageReport]="true" [tableStyle]="{ 'min-width': '50rem' }"
                currentPageReportTemplate="{first} de {last} registros" [rowsPerPageOptions]="[5, 10, 20, 30, 50, 100]"
                [breakpoint]="'992px'" responsiveLayout="stack" [(selection)]="casosSeleccionados">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 20px">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="numeroCaso">Número de caso
                            <p-sortIcon field="numeroCaso"></p-sortIcon>
                        </th>
                        <th pSortableColumn="origen">Origen
                            <p-sortIcon field="origen"></p-sortIcon>
                        </th>
                        <th pSortableColumn="remitente">Remitente
                            <p-sortIcon field="remitente"></p-sortIcon>
                        </th>
                        <th pSortableColumn="contacto">Despacho de procedencia
                            <p-sortIcon field="contacto"></p-sortIcon>
                        </th>
                        <th style="width: 175px" pSortableColumn="fechaIngreso">Fecha ingreso
                            <p-sortIcon field="fechaIngreso"></p-sortIcon>
                        </th>
                        <th style="width: 172px" pSortableColumn="delitos">Delitos y partes
                            <p-sortIcon field="delitos"></p-sortIcon>
                        </th>
                        <th></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-caso>
                    <tr class="p-selectable-row" [ngClass]="{'unread': caso.leido==0}">
                        <td class="table_td_content_start">
                            <p-tableCheckbox [value]="caso"></p-tableCheckbox>
                            <div class="block lg:hidden">
                                <div class="btn-more-options" (click)="menu.toggle($event)">
                                    <div class="btn-more-options-content">
                                        <span></span><span></span><span></span>
                                    </div>
                                </div>
                                <p-menu #menu [model]="opcionesMenu(caso)" [popup]="true" class="menu-options"></p-menu>
                            </div>
                        </td>
                        <td class="table_td_content_start caso-container">
                            <span class="p-column-title">Número de caso</span>
                            <div>
                                <span style="position: relative;display: flex;"
                                    [innerHTML]="obtenerNumeroCaso(caso.numeroCaso, caso.semaforoNro)"></span>
                            </div>
                            <div style="margin-top: 15px;">
                                <span class="cfe-semaforo-dias">
                                    <i class="pi pi-clock mr-2" ></i>
                                    {{ caso.semaforoTiempo }}
                                </span>
                            </div>
                        </td>
                        <td class="table_td_content_start">
                            <span class="p-column-title">Origen</span>
                            <span class="badge badge-{{ obtenerClaseDeOrigen2(caso.origen) }}">
                                {{ caso.origen }}
                            </span>
                        </td>
                        <td class="table_td_content_start remitente-container">
                            <span class="p-column-title">Remitente</span>
                            <div>
                                <div class="mb-1">
                                    <span class="badge badge-origen">{{ caso.tipoRemitente }}</span>
                                </div>
                                {{ caso.remitente }}
                            </div>
                        </td>
                        <td class="table_td_content_start">
                            <span class="p-column-title">Despacho de procedencia</span>
                            <div>
                                <div class="contact-item"><span>Teléfono:</span>{{ caso.telefono }}</div>
                                <div class="contact-item"><span>Correo:</span>{{ caso.correo }}</div>
                            </div>
                        </td>
                        <td class="fecha-container table_td_content_start">
                            <span class="p-column-title">Fecha ingreso</span>
                            <div>
                                <div>{{ caso.fechaIngreso }}</div>
                                <div>{{ caso.horaIngreso | dateformat : 'hour' }}</div>
                            </div>
                        </td>
                        <td class="table_td_content_start">
                            <span class="p-column-title">Delitos y partes</span>
                            <div class="btn-crimes-parts"
                                (click)="verDelitosPartes(caso.numeroCaso, caso.id,caso.leido)">
                                Ver delitos y partes ({{ caso.cantidadPartes }})
                            </div>
                        </td>
                        <td class="table_td_content_start">
                            <span class="p-column-title">&nbsp;</span>
                            <div class="hidden lg:block">
                                <div class="btn-more-options" (click)="menu2.toggle($event)">
                                    <div class="btn-more-options-content">
                                        <span></span><span></span><span></span>
                                    </div>
                                </div>
                                <p-menu #menu2 [model]="opcionesMenu(caso)" [popup]="true"
                                    class="menu-options"></p-menu>
                            </div>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="9" style="text-align: center;">No se encontraron registros con los criterios de
                            búsqueda ingresados
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

</div>

<p-toast></p-toast>