<div class="col-12 tableView">
  <p-table
    [tableStyle]="{ 'min-width': '120rem' }"
    [value]="listaCasos"
    [rowHover]="true"
    responsiveLayout="stack"
    styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th scope="col">N°</th>
        <th pSortableColumn="numeroCaso" scope="col">
          Nro Caso
          <p-sortIcon field="numeroCaso"></p-sortIcon>
        </th>
        <th pSortableColumn="etapa" scope="col">
          Etapa
          <p-sortIcon field="etapa"></p-sortIcon>
        </th>
        <th pSortableColumn="fiscal" scope="col">
          Despacho de procedencia
          <p-sortIcon field="fiscal"></p-sortIcon>
        </th>
        <th pSortableColumn="fiscalSuperiorAsignado" scope="col">
          Fiscal superior asignado
          <p-sortIcon field="fiscalSuperiorAsignado"></p-sortIcon>
        </th>
        <th pSortableColumn="fechaUltimoTramite" scope="col">
          Último trámite / fecha de último trámite
          <p-sortIcon field="fechaUltimoTramite"></p-sortIcon>
        </th>
        <th
          pSortableColumn="fechaElevacion"
          style="min-width: 11rem"
          scope="col"
        >
          Fecha de elevación
          <p-sortIcon field="fechaElevacion"></p-sortIcon>
        </th>
        <th scope="col">Plazo de pronunciamiento</th>
        <th scope="col"></th>
      </tr>
    </ng-template>

    <ng-template
      pTemplate="body"
      let-casofiscal
      let-columns="columns"
      let-rowIndex="rowIndex"
    >
      <tr
        class="relative cursor-pointer p-selectable-row"
        (click)="eventoCasoSeleccionado(casofiscal)"
      >
        <td
          [style.border-left]="
            '8px solid ' + getFilaEstilo(casofiscal) + ' !important'
          "
        >
          {{
            (paginacionCondicion.page - 1) * paginacionCondicion.limit +
              rowIndex +
              1
          }}
        </td>
        <td>
          <div class="p-column-title font-bold hidden">Nro Caso</div>
          <div>
            <div class="flex align-items-center mb-3">
              @if(casofiscal.plazos.length > 0) {
              <span
                class="plazo-item {{
                  consultaCasosGestionService.getLeyendaPlazosClasesCss()[
                  devuelvePlazoSemaforo(casofiscal)

                  ]
                }}"
              ></span>
              }
              <div
                [innerHTML]="obtenerCasoHtml(casofiscal.numeroCaso)"
                class="font-bold"
                style="white-space: nowrap"
              ></div>
            </div>
            <div
              class="cfe-etiqueta-accion flex align-items-center justify-content-between w-full etiqueta-retiro"
            >
              <p class="boton-etiqueta boton-etiqueta--rojo-claro">
                Con retiro de acusación
              </p>
            </div>
            @if (casofiscal.etiquetaColorNro !== null &&
            casofiscal.etiqueta!=='') {
            <span
              class="py-1 px-2 text-xs border-round-md font-semibold {{
                consultaCasosGestionService.getEtiquetaPlazosClasesCss()[
                  casofiscal.etiquetaColorNro
                ]
              }}"
              style="white-space: nowrap"
            >
              {{ casofiscal.etiqueta }}
            </span>
            } @let etiqueta2 = etiquetas2(casofiscal);
            <app-etiqueta-caso
              [etiqueta]="{
                flRevertido: casofiscal.flRevertido,
                flTipoAsignacion: casofiscal.tipoAsignacion,
                flReasignado: casofiscal.flagReasignado,
                etiquetaRgb: casofiscal.cssTextoElevacion,
                etiqueta: casofiscal.tipoElevacion,

                etiquetaRgb2: etiqueta2.color,
                etiqueta2: etiqueta2.valor
              }"
              [perfilJerarquia]="PerfilJerarquia.Superior"
            >
            </app-etiqueta-caso>
          </div>
        </td>
        <td>
          <div class="p-column-title font-bold hidden">Etapa</div>
          <div>
            <span class="capitalize">{{
              casofiscal.etapa ? casofiscal.etapa.toLowerCase() : ""
            }}</span>
          </div>
        </td>
        <td>
          <div class="p-column-title font-bold hidden">Fiscalia Provincial</div>
          <div>
            <div class="font-semibold capitalize">
              {{ casofiscal.fiscal ? casofiscal.fiscal.toLowerCase() : "" }}
            </div>
            <div class="text-700 capitalize">
              {{ casofiscal.fiscalia ? casofiscal.fiscalia.toLowerCase() : "" }}
            </div>
            <div class="font-semibold capitalize">
              {{ casofiscal.despacho ? casofiscal.despacho.toLowerCase() : "" }}
            </div>
          </div>
        </td>
        <td>
          <div class="p-column-title font-bold hidden">
            Fiscal superior asignado
          </div>
          <div class="capitalize">
            {{ usuario.fiscal ? usuario.fiscal : "" }}
          </div>
        </td>
        <td>
          <div class="p-column-title font-bold hidden">
            Último trámite / fecha de último trámite
          </div>
          <div>
            <div class="capitalize">
              {{
                casofiscal.ultimoTramite
                  ? casofiscal.ultimoTramite.toLowerCase()
                  : ""
              }}
            </div>
            <div class="pt-1 font-semibold">
              {{
                casofiscal.fechaUltimoTramite
                  ? (casofiscal.fechaUltimoTramite.split(" ")[0] | dateformat)
                  : ""
              }}
            </div>
            <div class="pt-1 font-semibold">
              {{
                casofiscal.fechaUltimoTramite
                  ? (casofiscal.fechaUltimoTramite.split(" ")[1]
                    | dateformat : "hour")
                  : ""
              }}
            </div>
          </div>
        </td>
        <td>
          <div class="p-column-title font-bold hidden">Fecha de elevación</div>
          <div>
            {{ casofiscal.fechaElevacion.split(" ")[0] | dateformat }}
          </div>
          <div class="pt-1">
            {{
              casofiscal.fechaElevacion
                ? (casofiscal.fechaElevacion.split(" ")[1]
                  | dateformat : "hour")
                : ""
            }}
          </div>
        </td>
        <td>
          <div class="p-column-title font-bold hidden">
            Plazo de pronunciamiento
          </div>
          @for (plazo of casofiscal.plazos; track $index) {
          @if(plazo.idJerarquia === 2) {
          <app-barra-progreso-caso
            [titulo]="plazo.nombreActoProcesal"
            [inicio]="plazo.diasTrasncurridos"
            [diasPlazo]="plazo.diasPlazo"
            [indicadorPlazo]="plazo.indSemaforo"
          >
          </app-barra-progreso-caso>
          } }
          <!--        <div class="py-2">
              <button class="cfe-boton-secondary cfe-boton-sm" routerLink="../listar-casos-anulados">Plazos y Pagos</button>
            </div> -->
        </td>
        <td>
          <app-menu-opciones-caso
            [opciones]="['Visor','Historial','Delitos']"
            [idCaso]="casofiscal.idCaso"
            [numeroCaso]="casofiscal.numeroCaso">
          </app-menu-opciones-caso>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8">
          @if (listaCasos.length === 0) {
          <div class="py-5 text-center text-600 border-300 font-semibold">
            @if (procesadoCriterioBusqueda===false) { En estos momentos no hay
            casos fiscales }@else { No se encontraron registros con los
            criterios de búsqueda ingresados }
          </div>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>
  @if(paginacionConfiguracion.total > 0) {
  <app-paginator
    [query]="paginacionCondicion"
    [items]="paginacionConfiguracion"
    [rowsPerPageOptions]="[]"
    [resetPage]="paginacionReiniciar"
    (paginate)="eventoCambiarPagina($event)"
  ></app-paginator>
  }
</div>
<!-- Ini - Opciones del Caso -->
<p-menu
  #opcionesCasoRef
  [model]="opcionesCaso"
  appendTo="body"
  [popup]="true"
></p-menu>
<!-- Fin - Opciones del Caso -->

<!-- Ini - Modal lista de delitos -->
@if(casoSeleccionadoLista){
<p-dialog
  [showHeader]="false"
  [(visible)]="mostrarDelitos"
  [modal]="true"
  [style]="{ 'min-width': '30vw', 'max-width': '1200px' }"
  [draggable]="true"
  [resizable]="false"
>
  <div class="m-0 p-0">
    <div class="flex w-full justify-content-between">
      <h3 class="cfe-subtitulo-3">Delitos</h3>
      <p-button
        type="button"
        icon="pi pi-times text-xl"
        (click)="eventoCerrarDelitos($event)"
        label=""
        tabindex="-1"
        styleClass="border-none text-gray-900 bg-white"
      ></p-button>
    </div>

    <span>
      <strong class="cfe-semi-bold">Caso: </strong>
      @if (casoSeleccionadoLista && casoSeleccionadoLista.numeroCaso) {
      <strong
        [innerHTML]="obtenerCasoHtml(casoSeleccionadoLista.numeroCaso!)"
      ></strong>
      }
    </span>

    <div>
      <p-table class="cfe-bold" [value]="casoSeleccionadoLista.delitos!">
        <ng-template pTemplate="header">
          <tr>
            <th scope="col">N°</th>
            <th scope="col">Delito</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-delitos let-i="rowIndex">
          <tr class="cfe-semi-bold">
            <td style="padding-right: 5px; width: 30px">{{ i + 1 }}</td>
            <td>{{ delitos.nombre }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</p-dialog>
}
<!-- Fin - Modal lista de delitos -->
