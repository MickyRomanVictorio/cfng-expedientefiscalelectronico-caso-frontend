<div class="tarjeta-cabecera-contenedor" (click)="eventoVerDetalleCaso(casofiscal())">
  <div class="tarjeta-cabecera" [ngClass]="getTarjetaTituloEstilo()">
    <div class="tarjeta-titulo">
      @if (casofiscal().numeroCaso) {
        <span [innerHTML]="obtenerCasoHtml(casofiscal().numeroCaso!)"></span>
      }
      @if (casofiscal().flgLecturaSuperior === '1') {
        <img src="assets/icons/eyesIcon.svg" alt="Solo lectura" class="ml-2 mt-1" style="filter: brightness(0) invert(1)"/>
      }
    </div>
  </div>
</div>

<div class="card-body-z" (click)="eventoVerDetalleCaso(casofiscal())" [ngClass]="{'leido': casofiscal().flgCasoLeido === '1'}">
  <div class="flex justify-content-between flex-wrap">
    <div class="flex align-items-center justify-content-center">
      <span>Etapa: <strong class="capitalize">{{casofiscal().etapa!.toLowerCase()}}</strong></span>
    </div>
    <div>
      <app-menu-opciones-caso
        [opciones]="['Visor','Historial','Delitos']"
        [idCaso]="casofiscal().idCaso"
        [numeroCaso]="casofiscal().numeroCaso">
      </app-menu-opciones-caso>
    </div>
  </div>

  @if (casofiscal().fiscal) {
    <div class="pt-3">
      <div>
          Fiscal:
        <div>
          <strong class="capitalize">{{casofiscal().fiscal!.toLowerCase()}}</strong>
        </div>
      </div>
    </div>
  }

  @if (casofiscal().fiscalia) {
    <div class="pt-3">
      <div>
          Fiscalía Provincial:
        <div>
          <strong class="capitalize">{{casofiscal().fiscalia!.toLowerCase()+' - ' + casofiscal().despacho!}}</strong>
        </div>
      </div>
    </div>
  }

  @if (casofiscal().fiscalSuperiorAsignado) {
    <div class="pt-3">
      <div>
          Fiscal superior asignado:
        <div>
          <strong class="capitalize">{{casofiscal().fiscalSuperiorAsignado!.toLowerCase()}}</strong>
        </div>
      </div>
    </div>
  }

  <div class="pt-3">
    Último trámite:
    <div>
      <strong class="capitalize">{{casofiscal().ultimoTramite?.toLowerCase() || "-"}}</strong>
    </div>
  </div>

  <div class="pt-3">
    Delitos:
    <div class="flex gap-2">
      @if (casofiscal().delitos) {
        <b>{{ verDelitoInicio(casofiscal().delitos!) }}</b>
        <span (click)="eventoVerDelitos($event)" class="cursor-pointer link">Ver más</span>
      }
    </div>
  </div>

  <div class="pt-3">
    <div class="flex justify-content-between flex-wrap">
      <div class="align-items-center">
         Fecha de elevacion
        <div><b>{{ casofiscal().fechaElevacion!.split(' ')[0] | dateformat }}</b></div>
      </div>
      <div class="align-items-center">
        F. de último trámite
        <div><b>{{ casofiscal().fechaUltimoTramite!.split(' ')[0] | dateformat }}</b></div>
      </div>
    </div>
  </div>

  <div class="py-4">
    @for (plazo of plazosPronunciamiento(casofiscal()); track $index) {
      <app-barra-progreso-caso
        [titulo]="plazo.descripcion"
        [inicio]="plazo.diasTrasncurridos!"
        [diasPlazo]="plazo.diasPlazo!"
        [indicadorPlazo]="plazo.indSemaforo!"
      >
      </app-barra-progreso-caso>
    }
  </div>

  <app-etiqueta-acciones-caso [casoFiscal]="casofiscal()" [perfilJerarquia]="PerfilJerarquia.Superior"></app-etiqueta-acciones-caso>

  <div class="pt-4">
    <app-nota-adhesiva [caso]="casofiscal()" [esSoloLectura]="true"></app-nota-adhesiva>
  </div>

</div>

<!-- Ini - Modal lista de delitos -->
<p-dialog
[showHeader]="false"
[(visible)]="mostrarDelitos"
[modal]="true"
[style]="{ 'min-width': '30vw', 'max-width': '1200px' }"
[draggable]="true"
[resizable]="false"
>
  <div class="m-0 p-0">

    <div class="flex w-full justify-content-between">
      <h3 class="cfe-subtitulo-3">Delitos</h3>
      <p-button type="button" icon="pi pi-times text-xl" (click)="eventoCerrarDelitos($event)" label="" tabindex="-1" styleClass="border-none text-gray-900 bg-white"></p-button>
    </div>

    <span>
      <strong class="cfe-semi-bold">Caso: </strong>
      @if (casofiscal().numeroCaso) {
        <strong [innerHTML]="obtenerCasoHtml(casofiscal().numeroCaso!)"></strong>
      }
    </span>

    <div>
      <p-table class="cfe-bold" [value]="casofiscal().delitos!">
        <ng-template pTemplate="header">
          <tr>
            <th scope="col">N°</th>
            <th scope="col">Delito</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-delitos let-i="rowIndex">
          <tr class="cfe-semi-bold">
            <td style="padding-right: 5px; width: 30px">{{ i + 1 }}</td>
            <td>{{ delitos.nombre }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

  </div>
</p-dialog>
<!-- Fin - Modal lista de delitos -->

